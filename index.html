<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>PsyLab - Flashcards</title>
    
    <!-- Manifest pro instalaci -->
    <link rel="manifest" href="data:application/manifest+json,{
        &quot;name&quot;: &quot;PsyLab Flashcards&quot;,
        &quot;short_name&quot;: &quot;PsyLab&quot;,
        &quot;description&quot;: &quot;Flashcards pro studenty psychologie&quot;,
        &quot;start_url&quot;: &quot;.&quot;,
        &quot;display&quot;: &quot;standalone&quot;,
        &quot;background_color&quot;: &quot;#f8fafc&quot;,
        &quot;theme_color&quot;: &quot;#0ea5e9&quot;,
        &quot;icons&quot;: [{
            &quot;src&quot;: &quot;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%230ea5e9'/%3E%3Cstop offset='100%25' stop-color='%23a855f7'/%3E%3C/linearGradient%3E%3Crect width='100' height='100' rx='20' fill='url(%23g)'/%3E%3Ctext x='50' y='70' font-size='60' text-anchor='middle' fill='white' font-family='Arial'%3Eüß†%3C/text%3E%3C/svg%3E&quot;,
            &quot;sizes&quot;: &quot;192x192&quot;,
            &quot;type&quot;: &quot;image/svg+xml&quot;
        }]
    }">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        
        body.dark {
            background: #0f172a !important;
            color: #e2e8f0;
        }
        
        body.dark .bg-white {
            background: #1e2937 !important;
            border-color: #334155 !important;
        }
        
        body.dark .bg-slate-50 {
            background: #0f172a !important;
        }
        
        body.dark .text-slate-800 {
            color: #f1f5f9 !important;
        }
        
        body.dark .text-slate-600 {
            color: #cbd5e1 !important;
        }
        
        body.dark .border-slate-200 {
            border-color: #334155 !important;
        }
        
        body.dark .glass-effect {
            background: rgba(30, 41, 59, 0.8) !important;
            border-color: #334155 !important;
        }
        
        body.dark .category-tag {
            background: #312e81 !important;
            color: #a5f3fc !important;
        }
        
        body.dark .card-front {
            background: #1e2937 !important;
            border-color: #334155 !important;
        }
	
	body.dark .flashcard-back p {  /* P≈ôesnƒõji pro text v odpovƒõdi */
    		color: #5eead4 !important;  /* Zmƒõ≈àte na po≈æadovanou barvu */
	}
        
        body.dark .card-back {
            background: linear-gradient(135deg, #1e2937 0%, #312e81 100%) !important;
            border-color: #4f46e5 !important;
        }
        
        .perspective {
            perspective: 2000px;
        }
        
        .preserve-3d {
            transform-style: preserve-3d;
        }
        
        .backface-hidden {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }
        
        .rotate-y-180 {
            transform: rotateY(180deg);
        }
        
        .card-transition {
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .animate-slide-up {
            animation: slideUp 0.4s ease-out forwards;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #0ea5e9 0%, #a855f7 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .category-tag {
            background: #f0f9ff;
            color: #0369a1;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        body.dark .category-tag {
            background: #312e81;
            color: #a5f3fc;
        }
        
        .tab {
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            font-weight: 500;
            transition: all 0.2s;
            color: #64748b;
        }
        
        .tab.active {
            background: white;
            color: #0ea5e9;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        body.dark .tab.active {
            background: #1e2937;
            color: #38bdf8;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #0ea5e9 0%, #a855f7 100%);
            color: white;
            border-radius: 1rem;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            transition: all 0.2s;
            box-shadow: 0 10px 15px -3px rgba(14, 165, 233, 0.2);
        }
        
        .btn-primary:active {
            transform: scale(0.96);
        }
        
        .btn-secondary {
            background: white;
            color: #0ea5e9;
            border: 1px solid #e2e8f0;
            border-radius: 1rem;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .btn-secondary:active {
            background: #f8fafc;
            transform: scale(0.96);
        }
        
        body.dark .btn-secondary {
            background: #1e2937;
            border-color: #334155;
            color: #38bdf8;
        }
        
        .modal {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
        }
        
        .rating-btn {
            border-radius: 1rem;
            padding: 1rem;
            font-weight: 500;
            transition: all 0.2s;
            border: 1px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }
        
        .rating-btn:active {
            transform: scale(0.94);
        }
        
        .rating-btn i {
            width: 24px;
            height: 24px;
        }
        
        /* Flashcard styling - ƒçist√© */
        .flashcard-container {
            min-height: 350px;
            width: 100%;
            cursor: pointer;
        }
        
        .flashcard {
            position: relative;
            width: 100%;
            height: 100%;
            min-height: 350px;
            transform-style: preserve-3d;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            min-height: 350px;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            border-radius: 1.5rem;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .flashcard-front {
            background: white;
            border: 1px solid #e2e8f0;
        }
        
        .flashcard-back {
            background: linear-gradient(135deg, #f0f9ff 0%, #faf5ff 100%);
            border: 1px solid #bae6fd;
            transform: rotateY(180deg);
        }
        
        body.dark .flashcard-front {
            background: #1e2937;
            border-color: #334155;
        }
        
        body.dark .flashcard-back {
            background: linear-gradient(135deg, #1e2937 0%, #312e81 100%);
            border-color: #4f46e5;
        }
        
        /* Status badges - jen ikona + text */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .status-badge i {
            width: 12px;
            height: 12px;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen p-4">

    <div class="max-w-md mx-auto">
        
        <!-- Header - s ikonou mozku -->
        <!-- Header - ƒçist√Ω, zarovnan√Ω vlevo -->
	<header class="flex items-center justify-between mb-4 animate-slide-up">
    	<div>
        	<h1 class="text-2xl font-bold">PsyLab</h1>
        	<p class="text-sm text-slate-500">Flashcards ‚Ä¢ <span id="statsText">0/0</span></p>
    	</div>
    	<div class="flex gap-2">
        	<button onclick="toggleDarkMode()" id="darkModeToggle" class="w-10 h-10 bg-white rounded-xl shadow-md flex items-center justify-center hover:shadow-lg active:scale-95 transition-all border border-slate-100">
            	<i data-feather="moon" class="w-5 h-5 text-slate-600"></i>
        	</button>
        	<button onclick="openCategoryModal()" class="w-10 h-10 bg-white rounded-xl shadow-md flex items-center justify-center hover:shadow-lg active:scale-95 transition-all border border-slate-100">
            	<i data-feather="tag" class="w-5 h-5 text-purple-500"></i>
        	</button>
        	<button onclick="openCardModal()" class="w-10 h-10 gradient-bg rounded-xl shadow-md flex items-center justify-center hover:shadow-lg active:scale-95 transition-all">
            	<i data-feather="plus" class="w-5 h-5 text-white"></i>
        	</button>
    	</div>
	</header>

        <!-- Install button -->
        <div id="installContainer" class="mb-4 hidden">
            <button onclick="installApp()" class="w-full bg-green-500 text-white p-3 rounded-xl shadow-md flex items-center justify-center gap-2 hover:bg-green-600 active:scale-95 transition-all">
                <i data-feather="download" class="w-4 h-4"></i>
                <span>Nainstalovat aplikaci do telefonu</span>
            </button>
        </div>

        <!-- Tabs -->
        <div class="glass-effect rounded-2xl p-1 mb-4 animate-slide-up" style="animation-delay: 0.1s">
            <div class="flex gap-1">
                <button onclick="switchTab('learn')" id="tabLearn" class="tab flex-1 active">
                    <i data-feather="book-open" class="w-4 h-4 inline mr-2"></i>
                    Uƒçen√≠
                </button>
                <button onclick="switchTab('manage')" id="tabManage" class="tab flex-1">
                    <i data-feather="edit-3" class="w-4 h-4 inline mr-2"></i>
                    Spr√°va
                </button>
            </div>
        </div>

        <!-- Progress Section -->
        <div id="progressSection" class="gradient-bg rounded-2xl p-5 text-white shadow-xl mb-4 animate-slide-up" style="animation-delay: 0.15s">
            <div class="flex items-center justify-between mb-3">
                <div>
                    <p class="text-white/80 text-sm">Denn√≠ pokrok</p>
                    <p class="text-2xl font-bold"><span id="kUceni">0</span> k uƒçen√≠</p>
                </div>
                <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm">
                    <i data-feather="trending-up" class="w-6 h-6 text-white"></i>
                </div>
            </div>
            <div class="h-2 bg-white/30 rounded-full overflow-hidden">
                <div id="progressBar" class="h-full bg-white rounded-full" style="width: 0%"></div>
            </div>
            <div class="flex justify-between mt-3 text-sm text-white/80">
                <span>Nauƒçeno: <span class="font-bold text-white" id="naucedo">0</span></span>
                <span>Celkem: <span class="font-bold text-white" id="celkemKaret">0</span></span>
            </div>
        </div>

        <!-- LEARN TAB -->
        <div id="learnTab">
            <!-- Empty state -->
            <div id="emptyState" class="text-center py-12 bg-white rounded-3xl shadow-sm border border-slate-100 hidden">
                <div class="w-24 h-24 bg-slate-100 rounded-3xl flex items-center justify-center mx-auto mb-4">
                    <i data-feather="book" class="w-12 h-12 text-slate-400"></i>
                </div>
                <h2 class="text-xl font-semibold text-slate-700 mb-2">≈Ω√°dn√© kartiƒçky</h2>
                <p class="text-slate-500 mb-6">P≈ôidejte svou prvn√≠ kartiƒçku</p>
                <button onclick="openCardModal()" class="btn-primary inline-flex items-center gap-2">
                    <i data-feather="plus" class="w-4 h-4"></i>
                    P≈ôidat kartiƒçku
                </button>
            </div>

            <!-- Flashcard area -->
            <div id="kartaArea" class="hidden">
                <!-- Card metadata - ƒçist√©, jen ikony a text -->
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                        <span class="category-tag" id="kartaKategorie">
                            <i data-feather="folder" class="w-3 h-3"></i>
                            <span>Obecn√°</span>
                        </span>
                        <span class="status-badge bg-orange-100 text-orange-600" id="kartaStatus">
                            <i data-feather="clock" class="w-3 h-3"></i>
                            <span>Nov√°</span>
                        </span>
                    </div>
                    <span class="text-sm text-slate-500" id="pocitadlo">1/5</span>
                </div>

                <!-- Flashcard - ƒçist√Ω, bez "ot√°zka/odpovƒõƒè" text≈Ø -->
                <div class="perspective mb-4 flashcard-container" onclick="otocKartu()">
                    <div id="flashcard" class="flashcard">
                        <!-- P≈ôedn√≠ strana -->
                        <div class="flashcard-front">
                            <div class="flex-1 flex items-center justify-center text-center">
                                <p class="text-xl font-medium text-slate-800 leading-relaxed" id="otazkaText"></p>
                            </div>
                            <div class="text-center text-slate-400 text-sm mt-2 flex items-center justify-center gap-1">
                                <i data-feather="mouse-pointer" class="w-3 h-3"></i>
                                Klepnƒõte pro otoƒçen√≠
                            </div>
                        </div>
                        
                        <!-- Zadn√≠ strana -->
                        <div class="flashcard-back">
                            <div class="flex-1 flex items-center justify-center text-center overflow-y-auto">
                                <p class="text-lg text-slate-700 leading-relaxed" id="odpovedText"></p>
                            </div>
                            <div class="text-center text-primary-400 text-sm mt-2 flex items-center justify-center gap-1">
                                <i data-feather="mouse-pointer" class="w-3 h-3"></i>
                                Zpƒõt na ot√°zku
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Rating buttons -->
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="hodnotit(1)" class="rating-btn" style="background: #dcfce7; color: #166534; border-color: #bbf7d0;">
                        <i data-feather="thumbs-up" class="text-emerald-600"></i>
                        <span>Ano</span>
                    </button>
                    <button onclick="hodnotit(2)" class="rating-btn" style="background: #dbeafe; color: #1e40af; border-color: #bfdbfe;">
                        <i data-feather="thumbs-up" class="text-blue-600"></i>
                        <span>Sp√≠≈°e ano</span>
                    </button>
                    <button onclick="hodnotit(3)" class="rating-btn" style="background: #fed7aa; color: #9a3412; border-color: #fdba74;">
                        <i data-feather="thumbs-down" class="text-orange-600"></i>
                        <span>Sp√≠≈°e ne</span>
                    </button>
                    <button onclick="hodnotit(4)" class="rating-btn" style="background: #fee2e2; color: #991b1b; border-color: #fecaca;">
                        <i data-feather="thumbs-down" class="text-red-600"></i>
                        <span>Ne</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- MANAGE TAB -->
        <div id="manageTab" class="hidden">
            <!-- Export/Import -->
            <div class="flex gap-2 mb-4">
                <button onclick="exportData()" class="flex-1 bg-white rounded-xl p-3 shadow-sm border border-slate-100 flex items-center justify-center gap-2 hover:shadow-md active:scale-95 transition-all">
                    <i data-feather="download" class="w-4 h-4 text-green-500"></i>
                    <span class="text-sm font-medium">Export</span>
                </button>
                <button onclick="document.getElementById('importFile').click()" class="flex-1 bg-white rounded-xl p-3 shadow-sm border border-slate-100 flex items-center justify-center gap-2 hover:shadow-md active:scale-95 transition-all">
                    <i data-feather="upload" class="w-4 h-4 text-blue-500"></i>
                    <span class="text-sm font-medium">Import</span>
                </button>
                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
            </div>

            <!-- Filter -->
            <div class="mb-4">
                <select id="categoryFilter" onchange="filterCards()" class="w-full p-4 bg-white rounded-2xl border border-slate-200 shadow-sm">
                    <option value="all">V≈°echny kategorie</option>
                </select>
            </div>

            <!-- Cards list -->
            <div id="cardsList" class="space-y-3"></div>
        </div>
    </div>

    <!-- MODAL pro kartu -->
    <div id="cardModal" class="fixed inset-0 modal hidden items-end justify-center p-4 z-50" style="display: none;">
        <div class="bg-white rounded-3xl w-full max-w-md p-6 shadow-2xl animate-slide-up">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-slate-800" id="cardModalTitle">Nov√° kartiƒçka</h3>
                <button onclick="closeCardModal()" class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center hover:bg-slate-200">
                    <i data-feather="x" class="w-5 h-5 text-slate-500"></i>
                </button>
            </div>
            
            <input type="hidden" id="editCardId">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Ot√°zka</label>
                    <input type="text" id="cardQuestion" placeholder="Nap≈ô. Kdo byl Freud?" class="w-full p-4 bg-slate-50 rounded-xl border border-slate-200">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Odpovƒõƒè</label>
                    <textarea id="cardAnswer" placeholder="Nap≈ô. Zakladatel psychoanal√Ωzy" rows="3" class="w-full p-4 bg-slate-50 rounded-xl border border-slate-200"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Kategorie</label>
                    <select id="cardCategory" class="w-full p-4 bg-slate-50 rounded-xl border border-slate-200"></select>
                </div>
                <button onclick="saveCard()" class="btn-primary w-full py-4 mt-4">
                    <i data-feather="check" class="w-4 h-4 inline mr-2"></i>
                    Ulo≈æit
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL pro kategorie -->
    <div id="categoryModal" class="fixed inset-0 modal hidden items-end justify-center p-4 z-50" style="display: none;">
        <div class="bg-white rounded-3xl w-full max-w-md p-6 shadow-2xl animate-slide-up">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-slate-800">Spr√°va kategori√≠</h3>
                <button onclick="closeCategoryModal()" class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center hover:bg-slate-200">
                    <i data-feather="x" class="w-5 h-5 text-slate-500"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div class="flex gap-2">
                    <input type="text" id="newCategoryName" placeholder="Nov√° kategorie" class="flex-1 p-4 bg-slate-50 rounded-xl border border-slate-200">
                    <button onclick="addCategory()" class="w-14 h-14 gradient-bg rounded-xl flex items-center justify-center shadow-md">
                        <i data-feather="plus" class="w-5 h-5 text-white"></i>
                    </button>
                </div>
                <div id="categoriesList" class="space-y-2 max-h-96 overflow-y-auto"></div>
            </div>
        </div>
    </div>

    <!-- CONFIRM MODAL -->
    <div id="confirmModal" class="fixed inset-0 modal hidden items-center justify-center p-4 z-[60]" style="display: none;">
        <div class="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl">
            <div class="w-16 h-16 bg-red-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <i data-feather="alert-triangle" class="w-8 h-8 text-red-500"></i>
            </div>
            <h3 class="text-xl font-bold text-center mb-2">Smazat kategorii?</h3>
            <p class="text-slate-600 text-center mb-6" id="confirmMessage"></p>
            <div class="flex gap-3">
                <button onclick="closeConfirmModal()" class="btn-secondary flex-1">Zpƒõt</button>
                <button onclick="executeDeleteCategory()" class="flex-1 bg-red-500 text-white py-4 rounded-xl font-medium hover:bg-red-600">
                    Ano, smazat
                </button>
            </div>
        </div>
    </div>

    <script>
        // Inicializace
        feather.replace();

        // Data
        const DEFAULT_CATEGORIES = ['Obecn√°', 'V√Ωvojov√°', 'Klinick√°', 'Soci√°ln√≠'];
        let karticky = JSON.parse(localStorage.getItem('karticky')) || [];
        let kategorie = JSON.parse(localStorage.getItem('kategorie')) || DEFAULT_CATEGORIES;
        
        let aktualniKarta = null;
        let otoceno = false;
        let kUCeni = [];
        let kategorieKeSmazani = null;

        // Dark mode
        let darkMode = localStorage.getItem('darkMode') === 'true';
        if (darkMode) document.body.classList.add('dark');

        window.toggleDarkMode = function() {
            darkMode = !darkMode;
            document.body.classList.toggle('dark');
            localStorage.setItem('darkMode', darkMode);
            document.querySelector('#darkModeToggle i').setAttribute('data-feather', darkMode ? 'sun' : 'moon');
            feather.replace();
        };

        // Instalace aplikace
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installContainer').classList.remove('hidden');
        });

        window.installApp = function() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then(() => {
                    deferredPrompt = null;
                    document.getElementById('installContainer').classList.add('hidden');
                });
            }
        };

        // Export/Import
        window.exportData = function() {
            const data = { karticky, kategorie, exportDate: new Date().toISOString() };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `psylab-${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            showToast('Data exportov√°na');
        };

        window.importData = function(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (imported.karticky && imported.kategorie) {
                        karticky = imported.karticky;
                        kategorie = imported.kategorie;
                        ulozData();
                        showToast('Data importov√°na');
                    }
                } catch (error) {
                    alert('Neplatn√Ω soubor');
                }
            };
            reader.readAsText(file);
        };

        function showToast(msg) {
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-8 left-1/2 -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-2xl shadow-xl z-50 flex items-center gap-2 animate-slide-up';
            toast.innerHTML = `<i data-feather="check-circle" class="w-5 h-5 text-green-400"></i><span>${msg}</span>`;
            document.body.appendChild(toast);
            feather.replace();
            setTimeout(() => toast.remove(), 2000);
        }

        function ulozData() {
            localStorage.setItem('karticky', JSON.stringify(karticky));
            localStorage.setItem('kategorie', JSON.stringify(kategorie));
            aktualizujSelecty();
            aktualizujUI();
        }

        function aktualizujSelecty() {
            const select = document.getElementById('cardCategory');
            if (select) select.innerHTML = kategorie.map(k => `<option value="${k}">${k}</option>`).join('');
            
            const filter = document.getElementById('categoryFilter');
            if (filter) filter.innerHTML = '<option value="all">V≈°echny</option>' + kategorie.map(k => `<option value="${k}">${k}</option>`).join('');
        }

        function aktualizujUI() {
            kUCeni = karticky.filter(k => k.vaha < 3);
            const celkem = karticky.length;
            const nauceno = karticky.filter(k => k.vaha >= 3).length;
            
            document.getElementById('statsText').innerText = `${nauceno}/${celkem}`;
            document.getElementById('kUceni').innerText = kUCeni.length;
            document.getElementById('naucedo').innerText = nauceno;
            document.getElementById('celkemKaret').innerText = celkem;
            document.getElementById('progressBar').style.width = celkem > 0 ? (nauceno / celkem) * 100 + '%' : '0%';
            
            if (celkem === 0) {
                document.getElementById('emptyState').classList.remove('hidden');
                document.getElementById('kartaArea').classList.add('hidden');
            } else {
                document.getElementById('emptyState').classList.add('hidden');
                document.getElementById('kartaArea').classList.remove('hidden');
                if (kUCeni.length > 0) vyberNahodnouKartu();
                else {
                    document.getElementById('otazkaText').innerText = "V≈°echny nauƒçen√©! üéâ";
                    document.getElementById('odpovedText').innerText = "Gratulujeme!";
                    document.getElementById('kartaStatus').innerHTML = '<i data-feather="check-circle"></i> Hotovo';
                }
            }
            renderCardsList();
        }

        function vyberNahodnouKartu() {
            if (kUCeni.length === 0) return;
            
            const vahy = kUCeni.map(k => 3 - k.vaha);
            const soucet = vahy.reduce((a, b) => a + b, 0);
            let nahodne = Math.random() * soucet;
            let vybrana = kUCeni[0];
            
            for (let i = 0; i < kUCeni.length; i++) {
                if (nahodne < (3 - kUCeni[i].vaha)) {
                    vybrana = kUCeni[i];
                    break;
                }
                nahodne -= (3 - kUCeni[i].vaha);
            }
            
            aktualniKarta = vybrana;
            otoceno = false;
            
            document.getElementById('flashcard').classList.remove('rotate-y-180');
            document.getElementById('otazkaText').innerText = vybrana.otazka;
            document.getElementById('odpovedText').innerText = vybrana.odpoved;
            document.getElementById('kartaKategorie').innerHTML = `<i data-feather="folder"></i> ${vybrana.kategorie}`;
            
            const index = kUCeni.findIndex(k => k.id === vybrana.id) + 1;
            document.getElementById('pocitadlo').innerText = `${index}/${kUCeni.length}`;
            
            // Status badges - jen ikona a text, bez emoji
            let statusIcon = 'clock';
            let statusText = 'Nov√°';
            if (vybrana.vaha === 1) { statusIcon = 'refresh-cw'; statusText = 'Opakov√°n√≠'; }
            else if (vybrana.vaha === 2) { statusIcon = 'alert-circle'; statusText = 'T√©mƒõ≈ô'; }
            
            document.getElementById('kartaStatus').innerHTML = `<i data-feather="${statusIcon}"></i> ${statusText}`;
            
            feather.replace();
        }

        window.otocKartu = function() {
            if (!aktualniKarta) return;
            document.getElementById('flashcard').classList.toggle('rotate-y-180');
            otoceno = !otoceno;
        };

        window.hodnotit = function(h) {
            if (!aktualniKarta) return;
            
            let zmena = h === 1 ? 1 : h === 2 ? 0.5 : h === 3 ? -0.5 : -1;
            aktualniKarta.vaha = Math.max(0, Math.min(4, aktualniKarta.vaha + zmena));
            aktualniKarta.hodnoceni.push({ h, cas: new Date().toISOString() });
            
            ulozData();
            vyberNahodnouKartu();
            showToast(h === 1 ? 'V√Ωbornƒõ!' : h === 2 ? 'Dob≈ôe' : h === 3 ? 'Je≈°tƒõ zkus√≠me' : 'Zopakujeme');
        };

        window.openCardModal = function(k = null) {
            document.getElementById('cardModalTitle').innerText = k ? 'Upravit' : 'Nov√°';
            document.getElementById('editCardId').value = k?.id || '';
            document.getElementById('cardQuestion').value = k?.otazka || '';
            document.getElementById('cardAnswer').value = k?.odpoved || '';
            document.getElementById('cardCategory').value = k?.kategorie || kategorie[0];
            document.getElementById('cardModal').style.display = 'flex';
        };

        window.closeCardModal = function() {
            document.getElementById('cardModal').style.display = 'none';
        };

        window.saveCard = function() {
            const id = document.getElementById('editCardId').value;
            const q = document.getElementById('cardQuestion').value;
            const a = document.getElementById('cardAnswer').value;
            const cat = document.getElementById('cardCategory').value;
            
            if (!q || !a) return alert('Vypl≈àte v≈°e');
            
            if (id) {
                const k = karticky.find(k => k.id == id);
                if (k) { k.otazka = q; k.odpoved = a; k.kategorie = cat; }
            } else {
                karticky.push({ id: Date.now(), otazka: q, odpoved: a, kategorie: cat, vaha: 0, hodnoceni: [] });
            }
            
            ulozData();
            closeCardModal();
        };

        window.deleteCard = function(id) {
            if (confirm('Smazat?')) {
                karticky = karticky.filter(k => k.id != id);
                ulozData();
            }
        };

        function renderCardsList() {
            const f = document.getElementById('categoryFilter')?.value || 'all';
            const filtered = f === 'all' ? karticky : karticky.filter(k => k.kategorie === f);
            
            document.getElementById('cardsList').innerHTML = filtered.length ? filtered.map(k => `
                <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100">
                    <div class="flex justify-between items-start mb-2">
                        <span class="category-tag"><i data-feather="folder"></i> ${k.kategorie}</span>
                        <div class="flex gap-1">
                            <button onclick='openCardModal(${JSON.stringify(k).replace(/'/g, "\\'")})' class="p-2 bg-blue-50 rounded-lg"><i data-feather="edit-2" class="w-4 h-4 text-blue-500"></i></button>
                            <button onclick="deleteCard(${k.id})" class="p-2 bg-red-50 rounded-lg"><i data-feather="trash-2" class="w-4 h-4 text-red-500"></i></button>
                        </div>
                    </div>
                    <p class="font-medium mb-1">‚ùì ${k.otazka}</p>
                    <p class="text-sm text-slate-600">üí° ${k.odpoved}</p>
                </div>
            `).join('') : '<div class="text-center py-8 text-slate-500">≈Ω√°dn√© kartiƒçky</div>';
            feather.replace();
        }

        window.filterCards = renderCardsList;

        // Kategorie
        window.openCategoryModal = function() {
            renderCategoriesList();
            document.getElementById('categoryModal').style.display = 'flex';
        };

        window.closeCategoryModal = function() {
            document.getElementById('categoryModal').style.display = 'none';
        };

        window.addCategory = function() {
            const n = document.getElementById('newCategoryName').value.trim();
            if (!n) return alert('Zadejte n√°zev');
            if (kategorie.includes(n)) return alert('Existuje');
            kategorie.push(n);
            ulozData();
            renderCategoriesList();
            document.getElementById('newCategoryName').value = '';
        };

        window.confirmDeleteCategory = function(nazev) {
            const pocet = karticky.filter(k => k.kategorie === nazev).length;
            if (pocet === 0) {
                if (confirm(`Smazat "${nazev}"?`)) {
                    kategorie = kategorie.filter(k => k !== nazev);
                    ulozData();
                    renderCategoriesList();
                }
            } else {
                kategorieKeSmazani = nazev;
                document.getElementById('confirmMessage').innerHTML = `Kategorie "${nazev}" obsahuje ${pocet} kartiƒçek. Budou tak√© smaz√°ny.`;
                document.getElementById('confirmModal').style.display = 'flex';
            }
        };

        window.closeConfirmModal = function() {
            document.getElementById('confirmModal').style.display = 'none';
            kategorieKeSmazani = null;
        };

        window.executeDeleteCategory = function() {
            if (kategorieKeSmazani) {
                karticky = karticky.filter(k => k.kategorie !== kategorieKeSmazani);
                kategorie = kategorie.filter(k => k !== kategorieKeSmazani);
                ulozData();
                closeConfirmModal();
                closeCategoryModal();
                renderCategoriesList();
            }
        };

        function renderCategoriesList() {
            document.getElementById('categoriesList').innerHTML = kategorie.map(k => `
                <div class="flex justify-between items-center bg-slate-50 p-4 rounded-xl">
                    <span>${k} (${karticky.filter(ka => ka.kategorie === k).length})</span>
                    <button onclick="confirmDeleteCategory('${k}')" class="p-2 bg-red-50 rounded-lg"><i data-feather="trash-2" class="w-4 h-4 text-red-500"></i></button>
                </div>
            `).join('');
            feather.replace();
        }

        // Tabs
        window.switchTab = function(tab) {
            if (tab === 'learn') {
                document.getElementById('learnTab').classList.remove('hidden');
                document.getElementById('manageTab').classList.add('hidden');
                document.getElementById('progressSection').classList.remove('hidden');
                document.getElementById('tabLearn').classList.add('active');
                document.getElementById('tabManage').classList.remove('active');
            } else {
                document.getElementById('learnTab').classList.add('hidden');
                document.getElementById('manageTab').classList.remove('hidden');
                document.getElementById('progressSection').classList.add('hidden');
                document.getElementById('tabLearn').classList.remove('active');
                document.getElementById('tabManage').classList.add('active');
                renderCardsList();
            }
        };

        // Click outside modals
        document.getElementById('cardModal').addEventListener('click', e => e.target === document.getElementById('cardModal') && closeCardModal());
        document.getElementById('categoryModal').addEventListener('click', e => e.target === document.getElementById('categoryModal') && closeCategoryModal());
        document.getElementById('confirmModal').addEventListener('click', e => e.target === document.getElementById('confirmModal') && closeConfirmModal());

        // Start
        (function init() {
            if (karticky.length === 0) {
                karticky = [
                    { id: 1, otazka: "Kdo byl Sigmund Freud?", odpoved: "Zakladatel psychoanal√Ωzy", kategorie: "Obecn√°", vaha: 0, hodnoceni: [] },
                    { id: 2, otazka: "Co je behaviorismus?", odpoved: "Smƒõr zamƒõ≈ôen√Ω na chov√°n√≠", kategorie: "Obecn√°", vaha: 0, hodnoceni: [] }
                ];
            }
            ulozData();
            aktualizujUI();
            renderCategoriesList();
            renderCardsList();
        })();
    </script>
</body>
</html>
