<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>PsyLab - Flashcards & Kv√≠zy</title>
    
    <!-- Manifest pro instalaci -->
    <link rel="manifest" href="data:application/manifest+json,{
        &quot;name&quot;: &quot;PsyLab Flashcards&quot;,
        &quot;short_name&quot;: &quot;PsyLab&quot;,
        &quot;description&quot;: &quot;Flashcards a kv√≠zy pro studenty psychologie&quot;,
        &quot;start_url&quot;: &quot;.&quot;,
        &quot;display&quot;: &quot;standalone&quot;,
        &quot;background_color&quot;: &quot;#f8fafc&quot;,
        &quot;theme_color&quot;: &quot;#0ea5e9&quot;,
        &quot;icons&quot;: [{
            &quot;src&quot;: &quot;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%230ea5e9'/%3E%3Cstop offset='100%25' stop-color='%23a855f7'/%3E%3C/linearGradient%3E%3Crect width='100' height='100' rx='20' fill='url(%23g)'/%3E%3Ctext x='50' y='70' font-size='60' text-anchor='middle' fill='white' font-family='Arial'%3Eüß†%3C/text%3E%3C/svg%3E&quot;,
            &quot;sizes&quot;: &quot;192x192&quot;,
            &quot;type&quot;: &quot;image/svg+xml&quot;
        }]
    }">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        
        body.dark {
            background: #0f172a !important;
            color: #e2e8f0;
        }
        
        body.dark .bg-white {
            background: #1e2937 !important;
            border-color: #334155 !important;
        }
        
        body.dark .bg-slate-50 {
            background: #0f172a !important;
        }
        
        body.dark .text-slate-800 {
            color: #f1f5f9 !important;
        }
        
        body.dark .text-slate-600 {
            color: #cbd5e1 !important;
        }
        
        body.dark .border-slate-200 {
            border-color: #334155 !important;
        }
        
        body.dark .glass-effect {
            background: rgba(30, 41, 59, 0.8) !important;
            border-color: #334155 !important;
        }
        
        body.dark .category-tag {
            background: #312e81 !important;
            color: #a5f3fc !important;
        }
        
        body.dark .card-front {
            background: #1e2937 !important;
            border-color: #334155 !important;
        }
    
        body.dark .flashcard-back p {
            color: #5eead4 !important;
        }
        
        body.dark .card-back {
            background: linear-gradient(135deg, #1e2937 0%, #312e81 100%) !important;
            border-color: #4f46e5 !important;
        }
        
        body.dark .quiz-option {
            background: #1e2937 !important;
            border-color: #334155 !important;
            color: #e2e8f0;
        }
        
        body.dark .quiz-option.selected {
            background: #312e81 !important;
            border-color: #4f46e5 !important;
        }
        
        body.dark .quiz-option.correct {
            background: #064e3b !important;
            border-color: #10b981 !important;
        }
        
        body.dark .quiz-option.incorrect {
            background: #7f1d1d !important;
            border-color: #ef4444 !important;
        }
        
        .perspective {
            perspective: 2000px;
        }
        
        .preserve-3d {
            transform-style: preserve-3d;
        }
        
        .backface-hidden {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }
        
        .rotate-y-180 {
            transform: rotateY(180deg);
        }
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .animate-slide-up {
            animation: slideUp 0.4s ease-out forwards;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #0ea5e9 0%, #a855f7 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .category-tag {
            background: #f0f9ff;
            color: #0369a1;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .nav-tab {
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            font-weight: 500;
            transition: all 0.2s;
            color: #64748b;
            flex: 1;
            text-align: center;
        }
        
        .nav-tab.active {
            background: white;
            color: #0ea5e9;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        body.dark .nav-tab.active {
            background: #1e2937;
            color: #38bdf8;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #0ea5e9 0%, #a855f7 100%);
            color: white;
            border-radius: 1rem;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            transition: all 0.2s;
            box-shadow: 0 10px 15px -3px rgba(14, 165, 233, 0.2);
        }
        
        .btn-primary:active {
            transform: scale(0.96);
        }
        
        .btn-secondary {
            background: white;
            color: #0ea5e9;
            border: 1px solid #e2e8f0;
            border-radius: 1rem;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .btn-secondary:active {
            background: #f8fafc;
            transform: scale(0.96);
        }
        
        body.dark .btn-secondary {
            background: #1e2937;
            border-color: #334155;
            color: #38bdf8;
        }
        
        .modal {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
        }
        
        .rating-btn {
            border-radius: 1rem;
            padding: 1rem;
            font-weight: 500;
            transition: all 0.2s;
            border: 1px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }
        
        .rating-btn i {
            width: 24px;
            height: 24px;
        }
        
        .control-btn {
            background: white;
            border-radius: 1rem;
            padding: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-weight: 500;
            transition: all 0.2s;
            border: 1px solid #e2e8f0;
            flex: 1;
        }
        
        .control-btn:active {
            transform: scale(0.96);
            background: #f8fafc;
        }
        
        body.dark .control-btn {
            background: #1e2937;
            border-color: #334155;
            color: #e2e8f0;
        }
        
        /* Flashcard styling */
        .flashcard-container {
            min-height: 350px;
            width: 100%;
            cursor: pointer;
        }
        
        .flashcard {
            position: relative;
            width: 100%;
            height: 100%;
            min-height: 350px;
            transform-style: preserve-3d;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            min-height: 350px;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            border-radius: 1.5rem;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .flashcard-front {
            background: white;
            border: 1px solid #e2e8f0;
        }
        
        .flashcard-back {
            background: linear-gradient(135deg, #f0f9ff 0%, #faf5ff 100%);
            border: 1px solid #bae6fd;
            transform: rotateY(180deg);
        }
        
        body.dark .flashcard-front {
            background: #1e2937;
            border-color: #334155;
        }
        
        body.dark .flashcard-back {
            background: linear-gradient(135deg, #1e2937 0%, #312e81 100%);
            border-color: #4f46e5;
        }
        
        /* Quiz styling */
        .quiz-option {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 1rem;
            padding: 1.25rem;
            transition: all 0.2s;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .quiz-option:hover {
            border-color: #0ea5e9;
            transform: translateY(-2px);
        }
        
        .quiz-option.selected {
            background: #e0f2fe;
            border-color: #0ea5e9;
        }
        
        .quiz-option.correct {
            background: #dcfce7;
            border-color: #10b981;
        }
        
        .quiz-option.incorrect {
            background: #fee2e2;
            border-color: #ef4444;
        }
        
        .quiz-option.disabled {
            pointer-events: none;
            opacity: 0.7;
        }
        
        .option-letter {
            width: 40px;
            height: 40px;
            background: #f1f5f9;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #0ea5e9;
        }
        
        body.dark .option-letter {
            background: #0f172a;
            color: #38bdf8;
        }
        
        .quiz-progress-bar {
            height: 8px;
            background: #e2e8f0;
            border-radius: 9999px;
            overflow: hidden;
        }
        
        .quiz-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0ea5e9, #a855f7);
            transition: width 0.3s ease;
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .status-badge i {
            width: 12px;
            height: 12px;
        }

        .card-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #0ea5e9;
        }

        .section-badge {
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 9999px;
            background: #e2e8f0;
            color: #475569;
        }
        
        body.dark .section-badge {
            background: #334155;
            color: #cbd5e1;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen p-4">

    <div class="max-w-md mx-auto">
        
        <!-- Header -->
        <header class="flex items-center justify-between mb-4 animate-slide-up">
            <div>
                <h1 class="text-2xl font-bold">PsyLab</h1>
                <p class="text-sm text-slate-500" id="headerSubtitle">Flashcards ‚Ä¢ <span id="statsFlashcards">0/0</span></p>
            </div>
            <div class="flex gap-2">
                <button onclick="toggleDarkMode()" id="darkModeToggle" class="w-10 h-10 bg-white rounded-xl shadow-md flex items-center justify-center hover:shadow-lg active:scale-95 transition-all border border-slate-100">
                    <i data-feather="moon" class="w-5 h-5 text-slate-600"></i>
                </button>
                <button onclick="openCategoryModal()" class="w-10 h-10 bg-white rounded-xl shadow-md flex items-center justify-center hover:shadow-lg active:scale-95 transition-all border border-slate-100">
                    <i data-feather="tag" class="w-5 h-5 text-purple-500"></i>
                </button>
                <button onclick="openAddModal('flashcard')" class="w-10 h-10 gradient-bg rounded-xl shadow-md flex items-center justify-center hover:shadow-lg active:scale-95 transition-all">
                    <i data-feather="plus" class="w-5 h-5 text-white"></i>
                </button>
            </div>
        </header>

        <!-- Install button -->
        <div id="installContainer" class="mb-4 hidden">
            <button onclick="installApp()" class="w-full bg-green-500 text-white p-3 rounded-xl shadow-md flex items-center justify-center gap-2 hover:bg-green-600 active:scale-95 transition-all">
                <i data-feather="download" class="w-4 h-4"></i>
                <span>Nainstalovat aplikaci do telefonu</span>
            </button>
        </div>

        <!-- Navigation Tabs -->
        <div class="glass-effect rounded-2xl p-1 mb-4 animate-slide-up" style="animation-delay: 0.1s">
            <div class="flex gap-1">
                <button onclick="switchMainTab('flashcards')" id="mainTabFlashcards" class="nav-tab active">
                    <i data-feather="layers" class="w-4 h-4 inline mr-2"></i>
                    Flashcards
                </button>
                <button onclick="switchMainTab('quiz')" id="mainTabQuiz" class="nav-tab">
                    <i data-feather="help-circle" class="w-4 h-4 inline mr-2"></i>
                    Kv√≠zy
                </button>
            </div>
        </div>

        <!-- FLASHCARDS SECTION -->
        <div id="flashcardsSection">
            <!-- Sub-tabs for Flashcards -->
            <div class="glass-effect rounded-2xl p-1 mb-4 animate-slide-up" style="animation-delay: 0.12s">
                <div class="flex gap-1">
                    <button onclick="switchFlashcardTab('learn')" id="flashcardTabLearn" class="tab flex-1 active">
                        <i data-feather="book-open" class="w-4 h-4 inline mr-2"></i>
                        Uƒçen√≠
                    </button>
                    <button onclick="switchFlashcardTab('manage')" id="flashcardTabManage" class="tab flex-1">
                        <i data-feather="edit-3" class="w-4 h-4 inline mr-2"></i>
                        Spr√°va
                    </button>
                </div>
            </div>

            <!-- Progress Section -->
            <div id="progressSection" class="gradient-bg rounded-2xl p-5 text-white shadow-xl mb-4 animate-slide-up" style="animation-delay: 0.15s">
                <div class="flex items-center justify-between mb-3">
                    <div>
                        <p class="text-white/80 text-sm">Flashcards - postup</p>
                        <p class="text-2xl font-bold"><span id="flashcardsKUceni">0</span> k uƒçen√≠</p>
                    </div>
                    <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm">
                        <i data-feather="trending-up" class="w-6 h-6 text-white"></i>
                    </div>
                </div>
                <div class="h-2 bg-white/30 rounded-full overflow-hidden">
                    <div id="flashcardsProgressBar" class="h-full bg-white rounded-full" style="width: 0%"></div>
                </div>
                <div class="flex justify-between mt-3 text-sm text-white/80">
                    <span>Nauƒçeno: <span class="font-bold text-white" id="flashcardsNaucedo">0</span></span>
                    <span>Celkem: <span class="font-bold text-white" id="flashcardsCelkem">0</span></span>
                </div>
            </div>

            <!-- LEARN TAB (Flashcards) -->
            <div id="flashcardsLearnTab">
                <!-- Ovl√°dac√≠ prvky -->
                <div class="flex gap-2 mb-4 animate-slide-up" style="animation-delay: 0.2s">
                    <button onclick="resetFlashcardsProgress()" class="control-btn">
                        <i data-feather="refresh-cw" class="w-4 h-4 text-blue-500"></i>
                        <span>Reset v≈°e</span>
                    </button>
                    <button onclick="reshuffleFlashcards()" class="control-btn">
                        <i data-feather="shuffle" class="w-4 h-4 text-purple-500"></i>
                        <span>Zam√≠chat</span>
                    </button>
                    <button onclick="showAllFlashcards()" class="control-btn">
                        <i data-feather="list" class="w-4 h-4 text-green-500"></i>
                        <span>V≈°echny</span>
                    </button>
                </div>

                <!-- V√Ωbƒõr kategorie -->
                <div class="mb-4 animate-slide-up" style="animation-delay: 0.25s">
                    <select id="flashcardsLearnFilter" onchange="filterFlashcardsLearn()" class="w-full p-4 bg-white rounded-2xl border border-slate-200 shadow-sm">
                        <option value="all">V≈°echny kategorie</option>
                    </select>
                </div>

                <!-- Empty state -->
                <div id="flashcardsEmptyState" class="text-center py-12 bg-white rounded-3xl shadow-sm border border-slate-100 hidden">
                    <div class="w-24 h-24 bg-slate-100 rounded-3xl flex items-center justify-center mx-auto mb-4">
                        <i data-feather="book" class="w-12 h-12 text-slate-400"></i>
                    </div>
                    <h2 class="text-xl font-semibold text-slate-700 mb-2">≈Ω√°dn√© flashcards</h2>
                    <p class="text-slate-500 mb-6">P≈ôidejte svou prvn√≠ kartiƒçku</p>
                    <button onclick="openAddModal('flashcard')" class="btn-primary inline-flex items-center gap-2">
                        <i data-feather="plus" class="w-4 h-4"></i>
                        P≈ôidat flashcard
                    </button>
                </div>

                <!-- Flashcard area -->
                <div id="flashcardsCardArea" class="hidden">
                    <!-- Card metadata -->
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-2">
                            <span class="category-tag" id="flashcardsKartaKategorie">
                                <i data-feather="folder" class="w-3 h-3"></i>
                                <span>Obecn√°</span>
                            </span>
                            <span class="status-badge bg-orange-100 text-orange-600" id="flashcardsKartaStatus">
                                <i data-feather="clock" class="w-3 h-3"></i>
                                <span>Nov√°</span>
                            </span>
                        </div>
                        <span class="text-sm text-slate-500" id="flashcardsPocitadlo">1/5</span>
                    </div>

                    <!-- Flashcard -->
                    <div class="perspective mb-4 flashcard-container" onclick="otocFlashcard()">
                        <div id="flashcardsFlashcard" class="flashcard">
                            <div class="flashcard-front">
                                <div class="flex-1 flex items-center justify-center text-center">
                                    <p class="text-xl font-medium text-slate-800 leading-relaxed" id="flashcardsOtazkaText"></p>
                                </div>
                                <div class="text-center text-slate-400 text-sm mt-2 flex items-center justify-center gap-1">
                                    <i data-feather="mouse-pointer" class="w-3 h-3"></i>
                                    Klepnƒõte pro otoƒçen√≠
                                </div>
                            </div>
                            <div class="flashcard-back">
                                <div class="flex-1 flex items-center justify-center text-center overflow-y-auto">
                                    <p class="text-lg text-slate-700 leading-relaxed" id="flashcardsOdpovedText"></p>
                                </div>
                                <div class="text-center text-primary-400 text-sm mt-2 flex items-center justify-center gap-1">
                                    <i data-feather="mouse-pointer" class="w-3 h-3"></i>
                                    Zpƒõt na ot√°zku
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Rating buttons -->
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="hodnotitFlashcard(1)" class="rating-btn" style="background: #dcfce7; color: #166534; border-color: #bbf7d0;">
                            <i data-feather="thumbs-up" class="text-emerald-600"></i>
                            <span>Ano</span>
                        </button>
                        <button onclick="hodnotitFlashcard(2)" class="rating-btn" style="background: #dbeafe; color: #1e40af; border-color: #bfdbfe;">
                            <i data-feather="thumbs-up" class="text-blue-600"></i>
                            <span>Sp√≠≈°e ano</span>
                        </button>
                        <button onclick="hodnotitFlashcard(3)" class="rating-btn" style="background: #fed7aa; color: #9a3412; border-color: #fdba74;">
                            <i data-feather="thumbs-down" class="text-orange-600"></i>
                            <span>Sp√≠≈°e ne</span>
                        </button>
                        <button onclick="hodnotitFlashcard(4)" class="rating-btn" style="background: #fee2e2; color: #991b1b; border-color: #fecaca;">
                            <i data-feather="thumbs-down" class="text-red-600"></i>
                            <span>Ne</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- MANAGE TAB (Flashcards) -->
            <div id="flashcardsManageTab" class="hidden">
                <!-- Export/Import -->
                <div class="flex gap-2 mb-4">
                    <button onclick="exportFlashcards()" class="flex-1 bg-white rounded-xl p-3 shadow-sm border border-slate-100 flex items-center justify-center gap-2 hover:shadow-md active:scale-95 transition-all">
                        <i data-feather="download" class="w-4 h-4 text-green-500"></i>
                        <span class="text-sm font-medium">Export</span>
                    </button>
                    <button onclick="document.getElementById('flashcardsImportFile').click()" class="flex-1 bg-white rounded-xl p-3 shadow-sm border border-slate-100 flex items-center justify-center gap-2 hover:shadow-md active:scale-95 transition-all">
                        <i data-feather="upload" class="w-4 h-4 text-blue-500"></i>
                        <span class="text-sm font-medium">Import</span>
                    </button>
                    <input type="file" id="flashcardsImportFile" accept=".json" style="display: none;" onchange="importFlashcards(event)">
                </div>

                <!-- Hromadn√© akce -->
                <div class="flex gap-2 mb-4">
                    <button onclick="resetSelectedFlashcards()" class="flex-1 bg-white rounded-xl p-3 shadow-sm border border-slate-100 flex items-center justify-center gap-2 hover:shadow-md active:scale-95 transition-all">
                        <i data-feather="refresh-ccw" class="w-4 h-4 text-orange-500"></i>
                        <span class="text-sm font-medium">Reset vybran√Ωch</span>
                    </button>
                    <button onclick="deleteSelectedFlashcards()" class="flex-1 bg-white rounded-xl p-3 shadow-sm border border-slate-100 flex items-center justify-center gap-2 hover:shadow-md active:scale-95 transition-all">
                        <i data-feather="trash-2" class="w-4 h-4 text-red-500"></i>
                        <span class="text-sm font-medium">Smazat vybran√©</span>
                    </button>
                </div>

                <!-- Filter -->
                <div class="mb-4">
                    <select id="flashcardsFilter" onchange="filterFlashcards()" class="w-full p-4 bg-white rounded-2xl border border-slate-200 shadow-sm">
                        <option value="all">V≈°echny kategorie</option>
                    </select>
                </div>

                <!-- Select All -->
                <div class="flex items-center justify-between mb-3 bg-white p-3 rounded-xl shadow-sm">
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="flashcardsSelectAll" onchange="toggleSelectAllFlashcards()" class="card-checkbox">
                        <label for="flashcardsSelectAll" class="text-sm font-medium">Vybrat v≈°e</label>
                    </div>
                    <span class="text-sm text-slate-500" id="flashcardsSelectedCount">0 vybr√°no</span>
                </div>

                <!-- Cards list -->
                <div id="flashcardsList" class="space-y-3"></div>
            </div>
        </div>

        <!-- QUIZ SECTION -->
        <div id="quizSection" class="hidden">
            <!-- Sub-tabs for Quiz -->
            <div class="glass-effect rounded-2xl p-1 mb-4 animate-slide-up" style="animation-delay: 0.12s">
                <div class="flex gap-1">
                    <button onclick="switchQuizTab('practice')" id="quizTabPractice" class="tab flex-1 active">
                        <i data-feather="help-circle" class="w-4 h-4 inline mr-2"></i>
                        Procviƒçov√°n√≠
                    </button>
                    <button onclick="switchQuizTab('history')" id="quizTabHistory" class="tab flex-1">
                        <i data-feather="bar-chart-2" class="w-4 h-4 inline mr-2"></i>
                        Historie
                    </button>
                    <button onclick="switchQuizTab('manage')" id="quizTabManage" class="tab flex-1">
                        <i data-feather="edit-3" class="w-4 h-4 inline mr-2"></i>
                        Spr√°va
                    </button>
                </div>
            </div>

            <!-- Quiz stats -->
            <div id="quizStatsSection" class="gradient-bg rounded-2xl p-5 text-white shadow-xl mb-4 animate-slide-up" style="animation-delay: 0.15s">
                <div class="flex items-center justify-between mb-3">
                    <div>
                        <p class="text-white/80 text-sm">Kv√≠zy - celkov√° statistika</p>
                        <p class="text-2xl font-bold"><span id="quizTotalQuestions">0</span> ot√°zek</p>
                    </div>
                    <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm">
                        <i data-feather="award" class="w-6 h-6 text-white"></i>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm text-white/80">
                    <div class="text-center">
                        <div class="font-bold text-white text-lg" id="quizCompletedCount">0</div>
                        <div>Absolvov√°no</div>
                    </div>
                    <div class="text-center">
                        <div class="font-bold text-white text-lg" id="quizAverageScore">0%</div>
                        <div>Pr≈Ømƒõr</div>
                    </div>
                    <div class="text-center">
                        <div class="font-bold text-white text-lg" id="quizBestScore">0%</div>
                        <div>Nejlep≈°√≠</div>
                    </div>
                </div>
            </div>

            <!-- PRACTICE TAB -->
            <div id="quizPracticeTab">
                <!-- Quiz controls -->
                <div class="flex gap-2 mb-4 animate-slide-up" style="animation-delay: 0.2s">
                    <button onclick="startNewQuiz()" class="control-btn">
                        <i data-feather="play" class="w-4 h-4 text-green-500"></i>
                        <span>Nov√Ω kv√≠z</span>
                    </button>
                    <button onclick="shuffleQuiz()" class="control-btn">
                        <i data-feather="shuffle" class="w-4 h-4 text-purple-500"></i>
                        <span>Zam√≠chat</span>
                    </button>
                </div>

                <!-- Quiz settings -->
                <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100 mb-4 animate-slide-up" style="animation-delay: 0.25s">
                    <h3 class="font-semibold mb-3 flex items-center gap-2">
                        <i data-feather="settings" class="w-4 h-4 text-slate-500"></i>
                        Nastaven√≠ kv√≠zu
                    </h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm text-slate-600 mb-2">Kategorie</label>
                            <select id="quizCategoryFilter" class="w-full p-3 bg-slate-50 rounded-xl border border-slate-200">
                                <option value="all">V≈°echny kategorie</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm text-slate-600 mb-2">Poƒçet ot√°zek</label>
                            <select id="quizQuestionCount" class="w-full p-3 bg-slate-50 rounded-xl border border-slate-200">
                                <option value="5">5 ot√°zek</option>
                                <option value="10" selected>10 ot√°zek</option>
                                <option value="15">15 ot√°zek</option>
                                <option value="20">20 ot√°zek</option>
                                <option value="all">V≈°echny dostupn√©</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Quiz progress -->
                <div id="quizActiveArea" class="hidden">
                    <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100 mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-sm font-medium" id="quizQuestionCounter">Ot√°zka 1/10</span>
                            <span class="status-badge bg-blue-100 text-blue-600">
                                <i data-feather="check-circle" class="w-3 h-3"></i>
                                <span id="quizScore">0/0 spr√°vnƒõ</span>
                            </span>
                        </div>
                        <div class="quiz-progress-bar mb-2">
                            <div id="quizProgressFill" class="quiz-progress-fill" style="width: 10%"></div>
                        </div>
                    </div>

                    <!-- Question -->
                    <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-100 mb-4">
                        <p class="text-lg font-medium mb-6" id="quizQuestion">Naƒç√≠t√°m ot√°zku...</p>
                        <div id="quizOptions" class="space-y-3"></div>
                    </div>

                    <!-- Navigation -->
                    <div class="flex gap-3">
                        <button onclick="previousQuizQuestion()" id="quizPrevBtn" class="btn-secondary flex-1 flex items-center justify-center gap-2" disabled>
                            <i data-feather="arrow-left" class="w-4 h-4"></i>
                            P≈ôedchoz√≠
                        </button>
                        <button onclick="nextQuizQuestion()" id="quizNextBtn" class="btn-primary flex-1 flex items-center justify-center gap-2">
                            Dal≈°√≠ <i data-feather="arrow-right" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>

                <!-- Empty state -->
                <div id="quizEmptyState" class="text-center py-12 bg-white rounded-3xl shadow-sm border border-slate-100">
                    <div class="w-24 h-24 bg-slate-100 rounded-3xl flex items-center justify-center mx-auto mb-4">
                        <i data-feather="help-circle" class="w-12 h-12 text-slate-400"></i>
                    </div>
                    <h2 class="text-xl font-semibold text-slate-700 mb-2">≈Ω√°dn√© kv√≠zov√© ot√°zky</h2>
                    <p class="text-slate-500 mb-6">P≈ôidejte ot√°zky do kv√≠zu</p>
                    <button onclick="openAddModal('quiz')" class="btn-primary inline-flex items-center gap-2">
                        <i data-feather="plus" class="w-4 h-4"></i>
                        P≈ôidat ot√°zku
                    </button>
                </div>

                <!-- Results -->
                <div id="quizResultsArea" class="hidden text-center py-8 bg-white rounded-3xl shadow-sm border border-slate-100">
                    <div class="w-24 h-24 bg-green-100 rounded-3xl flex items-center justify-center mx-auto mb-4">
                        <i data-feather="award" class="w-12 h-12 text-green-500"></i>
                    </div>
                    <h2 class="text-2xl font-bold mb-2" id="quizResultScore">0/10</h2>
                    <p class="text-slate-600 mb-6" id="quizResultMessage">V√Ωbornƒõ!</p>
                    <button onclick="startNewQuiz()" class="btn-primary flex items-center gap-2 mx-auto">
                        <i data-feather="refresh-cw" class="w-4 h-4"></i>
                        Nov√Ω kv√≠z
                    </button>
                </div>
            </div>

            <!-- HISTORY TAB -->
            <div id="quizHistoryTab" class="hidden">
                <!-- Filtry -->
                <div class="flex gap-2 mb-4 animate-slide-up" style="animation-delay: 0.2s">
                    <select id="historyTimeFilter" onchange="renderQuizHistory()" class="flex-1 p-3 bg-white rounded-xl border border-slate-200">
                        <option value="all">V≈°echna historie</option>
                        <option value="7">Posledn√≠ch 7 dn√≠</option>
                        <option value="30">Posledn√≠ch 30 dn√≠</option>
                        <option value="90">Posledn√≠ 3 mƒõs√≠ce</option>
                    </select>
                    <button onclick="clearQuizHistory()" class="p-3 bg-red-50 text-red-600 rounded-xl border border-red-200">
                        <i data-feather="trash-2" class="w-5 h-5"></i>
                    </button>
                </div>

                <!-- Graf -->
                <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100 mb-4">
                    <h3 class="font-semibold mb-3 flex items-center gap-2">
                        <i data-feather="trending-up" class="w-4 h-4 text-blue-500"></i>
                        V√Ωvoj √∫spƒõ≈°nosti
                    </h3>
                    <div id="chartContainer" class="h-48 flex items-end justify-around gap-1"></div>
                </div>

                <!-- Kategorie statistiky -->
                <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100 mb-4">
                    <h3 class="font-semibold mb-3 flex items-center gap-2">
                        <i data-feather="pie-chart" class="w-4 h-4 text-purple-500"></i>
                        √öspƒõ≈°nost podle kategori√≠
                    </h3>
                    <div id="categoryStats" class="space-y-3"></div>
                </div>

                <!-- Posledn√≠ v√Ωsledky -->
                <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100">
                    <h3 class="font-semibold mb-3 flex items-center gap-2">
                        <i data-feather="clock" class="w-4 h-4 text-orange-500"></i>
                        Posledn√≠ch 10 v√Ωsledk≈Ø
                    </h3>
                    <div id="recentResults" class="space-y-2"></div>
                </div>
            </div>

            <!-- MANAGE TAB (Quiz) -->
            <div id="quizManageTab" class="hidden">
                <!-- Export/Import -->
                <div class="flex gap-2 mb-4">
                    <button onclick="exportQuiz()" class="flex-1 bg-white rounded-xl p-3 shadow-sm border border-slate-100 flex items-center justify-center gap-2 hover:shadow-md active:scale-95 transition-all">
                        <i data-feather="download" class="w-4 h-4 text-green-500"></i>
                        <span class="text-sm font-medium">Export</span>
                    </button>
                    <button onclick="document.getElementById('quizImportFile').click()" class="flex-1 bg-white rounded-xl p-3 shadow-sm border border-slate-100 flex items-center justify-center gap-2 hover:shadow-md active:scale-95 transition-all">
                        <i data-feather="upload" class="w-4 h-4 text-blue-500"></i>
                        <span class="text-sm font-medium">Import</span>
                    </button>
                    <input type="file" id="quizImportFile" accept=".json" style="display: none;" onchange="importQuiz(event)">
                </div>

                <!-- Hromadn√© akce -->
                <div class="flex gap-2 mb-4">
                    <button onclick="deleteSelectedQuiz()" class="flex-1 bg-white rounded-xl p-3 shadow-sm border border-slate-100 flex items-center justify-center gap-2 hover:shadow-md active:scale-95 transition-all">
                        <i data-feather="trash-2" class="w-4 h-4 text-red-500"></i>
                        <span class="text-sm font-medium">Smazat vybran√©</span>
                    </button>
                </div>

                <!-- Filter -->
                <div class="mb-4">
                    <select id="quizFilter" onchange="filterQuiz()" class="w-full p-4 bg-white rounded-2xl border border-slate-200 shadow-sm">
                        <option value="all">V≈°echny kategorie</option>
                    </select>
                </div>

                <!-- Select All -->
                <div class="flex items-center justify-between mb-3 bg-white p-3 rounded-xl shadow-sm">
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="quizSelectAll" onchange="toggleSelectAllQuiz()" class="card-checkbox">
                        <label for="quizSelectAll" class="text-sm font-medium">Vybrat v≈°e</label>
                    </div>
                    <span class="text-sm text-slate-500" id="quizSelectedCount">0 vybr√°no</span>
                </div>

                <!-- Questions list -->
                <div id="quizList" class="space-y-3"></div>
            </div>
        </div>
    </div>

    <!-- MODAL pro p≈ôid√°n√≠/√∫pravu -->
    <div id="itemModal" class="fixed inset-0 modal hidden items-end justify-center p-4 z-50" style="display: none;">
        <div class="bg-white rounded-3xl w-full max-w-md p-6 shadow-2xl animate-slide-up">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-slate-800" id="modalTitle">Nov√° polo≈æka</h3>
                <button onclick="closeItemModal()" class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center hover:bg-slate-200">
                    <i data-feather="x" class="w-5 h-5 text-slate-500"></i>
                </button>
            </div>
            
            <input type="hidden" id="modalItemId">
            <input type="hidden" id="modalItemType">
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Ot√°zka</label>
                    <input type="text" id="modalQuestion" class="w-full p-4 bg-slate-50 rounded-xl border border-slate-200">
                </div>
                
                <div id="answerField">
                    <label class="block text-sm font-medium text-slate-700 mb-2">Odpovƒõƒè</label>
                    <textarea id="modalAnswer" rows="2" class="w-full p-4 bg-slate-50 rounded-xl border border-slate-200"></textarea>
                </div>
                
                <div id="quizOptionsField" class="hidden">
                    <label class="block text-sm font-medium text-slate-700 mb-2">Mo≈ænosti (oddƒõlen√© st≈ôedn√≠kem)</label>
                    <textarea id="modalQuizOptions" rows="3" class="w-full p-4 bg-slate-50 rounded-xl border border-slate-200"></textarea>
                    <p class="text-xs text-slate-500 mt-1">Prvn√≠ mo≈ænost by mƒõla b√Ωt spr√°vn√°</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Kategorie</label>
                    <select id="modalCategory" class="w-full p-4 bg-slate-50 rounded-xl border border-slate-200"></select>
                </div>
                
                <button onclick="saveItem()" class="btn-primary w-full py-4 mt-4">
                    <i data-feather="check" class="w-4 h-4 inline mr-2"></i>
                    Ulo≈æit
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL pro kategorie -->
    <div id="categoryModal" class="fixed inset-0 modal hidden items-end justify-center p-4 z-50" style="display: none;">
        <div class="bg-white rounded-3xl w-full max-w-md p-6 shadow-2xl animate-slide-up">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-slate-800">Spr√°va kategori√≠</h3>
                <button onclick="closeCategoryModal()" class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center hover:bg-slate-200">
                    <i data-feather="x" class="w-5 h-5 text-slate-500"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div class="flex gap-2">
                    <input type="text" id="newCategoryName" placeholder="Nov√° kategorie" class="flex-1 p-4 bg-slate-50 rounded-xl border border-slate-200">
                    <button onclick="addCategory()" class="w-14 h-14 gradient-bg rounded-xl flex items-center justify-center shadow-md">
                        <i data-feather="plus" class="w-5 h-5 text-white"></i>
                    </button>
                </div>
                <div id="categoriesList" class="space-y-2 max-h-96 overflow-y-auto"></div>
            </div>
        </div>
    </div>

    <!-- CONFIRM MODAL -->
    <div id="confirmModal" class="fixed inset-0 modal hidden items-center justify-center p-4 z-[60]" style="display: none;">
        <div class="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl">
            <div class="w-16 h-16 bg-red-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <i data-feather="alert-triangle" class="w-8 h-8 text-red-500"></i>
            </div>
            <h3 class="text-xl font-bold text-center mb-2" id="confirmTitle">Potvrƒète akci</h3>
            <p class="text-slate-600 text-center mb-6" id="confirmMessage"></p>
            <div class="flex gap-3">
                <button onclick="closeConfirmModal()" class="btn-secondary flex-1">Zpƒõt</button>
                <button onclick="executeConfirmedAction()" id="confirmActionBtn" class="flex-1 bg-red-500 text-white py-4 rounded-xl font-medium hover:bg-red-600">
                    Ano, smazat
                </button>
            </div>
        </div>
    </div>

    <script>
        // Inicializace
        feather.replace();

        // Data
        const DEFAULT_CATEGORIES = ['Obecn√°', 'V√Ωvojov√°', 'Klinick√°', 'Soci√°ln√≠'];
        
        // Flashcards data
        let flashcards = JSON.parse(localStorage.getItem('psylab_flashcards')) || [];
        
        // Quiz data
        let quizQuestions = JSON.parse(localStorage.getItem('psylab_quiz')) || [];
        
        // Sd√≠len√© kategorie
        let kategorie = JSON.parse(localStorage.getItem('psylab_categories')) || DEFAULT_CATEGORIES;
        
        // Flashcards state
        let currentFlashcard = null;
        let flashcardFlipped = false;
        let flashcardsToLearn = [];
        let flashcardsLearnFilter = 'all';
        let selectedFlashcards = new Set();
        
        // Quiz state
        let currentQuizQuestions = [];
        let currentQuizIndex = 0;
        let userAnswers = [];
        let quizActive = false;
        let quizHistory = JSON.parse(localStorage.getItem('psylab_quiz_history')) || [];
        let selectedQuiz = new Set();
        
        // Confirm modal
        let confirmAction = null;
        let categoryToDelete = null;

        // Dark mode
        let darkMode = localStorage.getItem('psylab_darkMode') === 'true';
        if (darkMode) document.body.classList.add('dark');

        window.toggleDarkMode = function() {
            darkMode = !darkMode;
            document.body.classList.toggle('dark');
            localStorage.setItem('psylab_darkMode', darkMode);
            document.querySelector('#darkModeToggle i').setAttribute('data-feather', darkMode ? 'sun' : 'moon');
            feather.replace();
        };

        // Instalace
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installContainer').classList.remove('hidden');
        });

        window.installApp = function() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then(() => {
                    deferredPrompt = null;
                    document.getElementById('installContainer').classList.add('hidden');
                });
            }
        };

        // Navigace
        window.switchMainTab = function(tab) {
            if (tab === 'flashcards') {
                document.getElementById('flashcardsSection').classList.remove('hidden');
                document.getElementById('quizSection').classList.add('hidden');
                document.getElementById('mainTabFlashcards').classList.add('active');
                document.getElementById('mainTabQuiz').classList.remove('active');
                updateFlashcardsHeader();
                updateFlashcardsUI();
            } else {
                document.getElementById('flashcardsSection').classList.add('hidden');
                document.getElementById('quizSection').classList.remove('hidden');
                document.getElementById('mainTabFlashcards').classList.remove('active');
                document.getElementById('mainTabQuiz').classList.add('active');
                updateQuizHeader();
                updateQuizUI();
            }
        };

        window.switchFlashcardTab = function(tab) {
            if (tab === 'learn') {
                document.getElementById('flashcardsLearnTab').classList.remove('hidden');
                document.getElementById('flashcardsManageTab').classList.add('hidden');
                document.getElementById('flashcardTabLearn').classList.add('active');
                document.getElementById('flashcardTabManage').classList.remove('active');
            } else {
                document.getElementById('flashcardsLearnTab').classList.add('hidden');
                document.getElementById('flashcardsManageTab').classList.remove('hidden');
                document.getElementById('flashcardTabLearn').classList.remove('active');
                document.getElementById('flashcardTabManage').classList.add('active');
                renderFlashcardsList();
            }
        };

        window.switchQuizTab = function(tab) {
            if (tab === 'practice') {
                document.getElementById('quizPracticeTab').classList.remove('hidden');
                document.getElementById('quizHistoryTab').classList.add('hidden');
                document.getElementById('quizManageTab').classList.add('hidden');
                document.getElementById('quizTabPractice').classList.add('active');
                document.getElementById('quizTabHistory').classList.remove('active');
                document.getElementById('quizTabManage').classList.remove('active');
            } else if (tab === 'history') {
                document.getElementById('quizPracticeTab').classList.add('hidden');
                document.getElementById('quizHistoryTab').classList.remove('hidden');
                document.getElementById('quizManageTab').classList.add('hidden');
                document.getElementById('quizTabPractice').classList.remove('active');
                document.getElementById('quizTabHistory').classList.add('active');
                document.getElementById('quizTabManage').classList.remove('active');
                renderQuizHistory();
            } else {
                document.getElementById('quizPracticeTab').classList.add('hidden');
                document.getElementById('quizHistoryTab').classList.add('hidden');
                document.getElementById('quizManageTab').classList.remove('hidden');
                document.getElementById('quizTabPractice').classList.remove('active');
                document.getElementById('quizTabHistory').classList.remove('active');
                document.getElementById('quizTabManage').classList.add('active');
                renderQuizList();
            }
        };

        // ==================== FLASHCARDS ====================

        function updateFlashcardsHeader() {
            const celkem = flashcards.length;
            const nauceno = flashcards.filter(f => f.vaha >= 3).length;
            document.getElementById('statsFlashcards').innerText = `${nauceno}/${celkem}`;
            document.getElementById('headerSubtitle').innerHTML = `Flashcards ‚Ä¢ <span id="statsFlashcards">${nauceno}/${celkem}</span>`;
        }

        function saveFlashcards() {
            localStorage.setItem('psylab_flashcards', JSON.stringify(flashcards));
            updateFlashcardsUI();
        }

        function updateFlashcardsUI() {
            flashcardsToLearn = flashcards.filter(f => {
                if (flashcardsLearnFilter !== 'all' && f.kategorie !== flashcardsLearnFilter) return false;
                return f.vaha < 3;
            });
            
            const celkem = flashcards.length;
            const nauceno = flashcards.filter(f => f.vaha >= 3).length;
            
            document.getElementById('flashcardsKUceni').innerText = flashcardsToLearn.length;
            document.getElementById('flashcardsNaucedo').innerText = nauceno;
            document.getElementById('flashcardsCelkem').innerText = celkem;
            document.getElementById('flashcardsProgressBar').style.width = celkem > 0 ? (nauceno / celkem) * 100 + '%' : '0%';
            
            if (celkem === 0) {
                document.getElementById('flashcardsEmptyState').classList.remove('hidden');
                document.getElementById('flashcardsCardArea').classList.add('hidden');
            } else {
                document.getElementById('flashcardsEmptyState').classList.add('hidden');
                document.getElementById('flashcardsCardArea').classList.remove('hidden');
                if (flashcardsToLearn.length > 0) {
                    showRandomFlashcard();
                } else {
                    showAllFlashcards();
                }
            }
            updateFlashcardsHeader();
        }

        window.showRandomFlashcard = function() {
            if (flashcardsToLearn.length === 0) {
                showAllFlashcards();
                return;
            }
            
            const randomIndex = Math.floor(Math.random() * flashcardsToLearn.length);
            currentFlashcard = flashcardsToLearn[randomIndex];
            flashcardFlipped = false;
            
            document.getElementById('flashcardsFlashcard').classList.remove('rotate-y-180');
            document.getElementById('flashcardsOtazkaText').innerText = currentFlashcard.otazka;
            document.getElementById('flashcardsOdpovedText').innerText = currentFlashcard.odpoved;
            document.getElementById('flashcardsKartaKategorie').innerHTML = `<i data-feather="folder"></i> ${currentFlashcard.kategorie}`;
            
            const index = flashcardsToLearn.findIndex(f => f.id === currentFlashcard.id) + 1;
            document.getElementById('flashcardsPocitadlo').innerText = `${index}/${flashcardsToLearn.length}`;
            
            updateFlashcardStatus(currentFlashcard);
            feather.replace();
        };

        window.showAllFlashcards = function() {
            const all = flashcards.filter(f => {
                if (flashcardsLearnFilter === 'all') return true;
                return f.kategorie === flashcardsLearnFilter;
            });
            
            if (all.length === 0) return;
            
            const randomIndex = Math.floor(Math.random() * all.length);
            currentFlashcard = all[randomIndex];
            flashcardFlipped = false;
            
            document.getElementById('flashcardsFlashcard').classList.remove('rotate-y-180');
            document.getElementById('flashcardsOtazkaText').innerText = currentFlashcard.otazka;
            document.getElementById('flashcardsOdpovedText').innerText = currentFlashcard.odpoved;
            document.getElementById('flashcardsKartaKategorie').innerHTML = `<i data-feather="folder"></i> ${currentFlashcard.kategorie}`;
            
            const index = all.findIndex(f => f.id === currentFlashcard.id) + 1;
            document.getElementById('flashcardsPocitadlo').innerText = `${index}/${all.length}`;
            
            updateFlashcardStatus(currentFlashcard);
            feather.replace();
        };

        window.otocFlashcard = function() {
            if (!currentFlashcard) return;
            document.getElementById('flashcardsFlashcard').classList.toggle('rotate-y-180');
            flashcardFlipped = !flashcardFlipped;
        };

        window.hodnotitFlashcard = function(h) {
            if (!currentFlashcard) return;
            
            let change = h === 1 ? 1 : h === 2 ? 0.5 : h === 3 ? -0.5 : -1;
            currentFlashcard.vaha = Math.max(0, Math.min(4, currentFlashcard.vaha + change));
            currentFlashcard.hodnoceni.push({ h, cas: new Date().toISOString() });
            
            saveFlashcards();
            
            flashcardsToLearn = flashcards.filter(f => {
                if (flashcardsLearnFilter !== 'all' && f.kategorie !== flashcardsLearnFilter) return false;
                return f.vaha < 3;
            });
            
            if (flashcardsToLearn.length > 0) {
                showRandomFlashcard();
            } else {
                showAllFlashcards();
            }
            
            showToast(h === 1 ? 'V√Ωbornƒõ!' : h === 2 ? 'Dob≈ôe' : h === 3 ? 'Je≈°tƒõ zkus√≠me' : 'Zopakujeme');
        };

        window.filterFlashcardsLearn = function() {
            flashcardsLearnFilter = document.getElementById('flashcardsLearnFilter').value;
            flashcardsToLearn = flashcards.filter(f => {
                if (flashcardsLearnFilter !== 'all' && f.kategorie !== flashcardsLearnFilter) return false;
                return f.vaha < 3;
            });
            
            if (flashcardsToLearn.length > 0) {
                showRandomFlashcard();
            } else {
                showAllFlashcards();
            }
        };

        window.resetFlashcardsProgress = function() {
            showConfirm(
                'Resetovat flashcards?',
                'V≈°em kartiƒçk√°m bude nastavena v√°ha 0.',
                () => {
                    flashcards.forEach(f => {
                        f.vaha = 0;
                        f.hodnoceni = [];
                    });
                    saveFlashcards();
                    showToast('Flashcards resetov√°ny');
                }
            );
        };

        window.reshuffleFlashcards = function() {
            flashcardsToLearn = flashcards.filter(f => {
                if (flashcardsLearnFilter !== 'all' && f.kategorie !== flashcardsLearnFilter) return false;
                return f.vaha < 3;
            });
            showRandomFlashcard();
            showToast('Seznam zam√≠ch√°n');
        };

        function updateFlashcardStatus(flashcard) {
            let statusIcon = 'clock';
            let statusText = 'Nov√°';
            if (flashcard.vaha === 1) { statusIcon = 'refresh-cw'; statusText = 'Opakov√°n√≠'; }
            else if (flashcard.vaha === 2) { statusIcon = 'alert-circle'; statusText = 'T√©mƒõ≈ô'; }
            else if (flashcard.vaha >= 3) { statusIcon = 'check-circle'; statusText = 'Nauƒçeno'; }
            
            document.getElementById('flashcardsKartaStatus').innerHTML = `<i data-feather="${statusIcon}"></i> ${statusText}`;
        }

        // ==================== Kv√≠z ====================

        function updateQuizHeader() {
            const total = quizQuestions.length;
            const completed = quizHistory.length;
            
            const avg = quizHistory.length > 0 
                ? Math.round(quizHistory.reduce((sum, q) => sum + (q.score / q.total * 100), 0) / quizHistory.length) 
                : 0;
            
            const best = quizHistory.length > 0
                ? Math.max(...quizHistory.map(q => (q.score / q.total * 100)))
                : 0;
            
            document.getElementById('quizTotalQuestions').innerText = total;
            document.getElementById('quizCompletedCount').innerText = completed;
            document.getElementById('quizAverageScore').innerText = avg + '%';
            document.getElementById('quizBestScore').innerText = Math.round(best) + '%';
            document.getElementById('headerSubtitle').innerHTML = `Kv√≠zy ‚Ä¢ ${total} ot√°zek`;
        }

        function saveQuiz() {
            localStorage.setItem('psylab_quiz', JSON.stringify(quizQuestions));
            localStorage.setItem('psylab_quiz_history', JSON.stringify(quizHistory));
            updateQuizUI();
        }

        function updateQuizUI() {
            updateQuizHeader();
            
            if (quizQuestions.length === 0) {
                document.getElementById('quizEmptyState').classList.remove('hidden');
                document.getElementById('quizActiveArea').classList.add('hidden');
                document.getElementById('quizStatsSection').classList.add('hidden');
            } else {
                document.getElementById('quizEmptyState').classList.add('hidden');
                document.getElementById('quizStatsSection').classList.remove('hidden');
            }
        }

        function generateQuizOptions(correctAnswer) {
            const distractors = [
                "Carl Jung", "B.F. Skinner", "Carl Rogers", "Abraham Maslow",
                "Jean Piaget", "Lev Vygotsky", "John Watson", "Ivan Pavlov",
                "Erik Erikson", "Karen Horney", "Alfred Adler", "William James",
                "Kognitivn√≠ psychologie", "Behavior√°ln√≠ psychologie", "Humanistick√° psychologie", "Psychoanal√Ωza",
                "Pamƒõ≈•", "My≈°len√≠", "Vn√≠m√°n√≠", "Uƒçen√≠", "Emoce", "Motivace"
            ];
            
            const options = [correctAnswer];
            while (options.length < 4) {
                const random = distractors[Math.floor(Math.random() * distractors.length)];
                if (!options.includes(random)) {
                    options.push(random);
                }
            }
            
            for (let i = options.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [options[i], options[j]] = [options[j], options[i]];
            }
            
            return options;
        }

        window.startNewQuiz = function() {
            const category = document.getElementById('quizCategoryFilter').value;
            const countOption = document.getElementById('quizQuestionCount').value;
            
            let availableQuestions = quizQuestions.filter(q => {
                if (category !== 'all' && q.kategorie !== category) return false;
                return true;
            });
            
            if (availableQuestions.length === 0) {
                showToast('≈Ω√°dn√© ot√°zky k dispozici');
                return;
            }
            
            let questionCount = countOption === 'all' ? availableQuestions.length : parseInt(countOption);
            questionCount = Math.min(questionCount, availableQuestions.length);
            
            const shuffled = [...availableQuestions].sort(() => 0.5 - Math.random());
            currentQuizQuestions = shuffled.slice(0, questionCount);
            
            userAnswers = new Array(currentQuizQuestions.length).fill(null);
            currentQuizIndex = 0;
            quizActive = true;
            
            document.getElementById('quizEmptyState').classList.add('hidden');
            document.getElementById('quizResultsArea').classList.add('hidden');
            document.getElementById('quizActiveArea').classList.remove('hidden');
            
            renderQuizQuestion();
        };

        window.shuffleQuiz = function() {
            if (currentQuizQuestions.length === 0) return;
            
            for (let i = currentQuizQuestions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [currentQuizQuestions[i], currentQuizQuestions[j]] = [currentQuizQuestions[j], currentQuizQuestions[i]];
            }
            
            userAnswers = new Array(currentQuizQuestions.length).fill(null);
            currentQuizIndex = 0;
            renderQuizQuestion();
            showToast('Ot√°zky zam√≠ch√°ny');
        };

        window.showQuizResults = function(show = true) {
            if (show) {
                const correct = userAnswers.filter((ans, idx) => ans === currentQuizQuestions[idx]?.odpoved).length;
                
                document.getElementById('quizResultScore').innerText = `${correct}/${currentQuizQuestions.length}`;
                
                let message = '';
                const percentage = (correct / currentQuizQuestions.length) * 100;
                if (percentage >= 90) message = 'V√Ωbornƒõ! Jste expert!';
                else if (percentage >= 75) message = 'Velmi dob≈ôe!';
                else if (percentage >= 60) message = 'Dobr√©, ale m≈Ø≈æe to b√Ωt lep≈°√≠';
                else if (percentage >= 40) message = 'Je pot≈ôeba v√≠ce studovat';
                else message = 'Nevzd√°vejte to, p≈ô√≠≈°tƒõ to bude lep≈°√≠';
                
                document.getElementById('quizResultMessage').innerText = message;
                
                quizHistory.push({
                    date: new Date().toISOString(),
                    score: correct,
                    total: currentQuizQuestions.length,
                    category: document.getElementById('quizCategoryFilter').value,
                    percentage: percentage
                });
                
                if (quizHistory.length > 50) {
                    quizHistory = quizHistory.slice(-50);
                }
                
                localStorage.setItem('psylab_quiz_history', JSON.stringify(quizHistory));
                
                document.getElementById('quizActiveArea').classList.add('hidden');
                document.getElementById('quizResultsArea').classList.remove('hidden');
                
                updateQuizHeader();
            } else {
                document.getElementById('quizResultsArea').classList.add('hidden');
                document.getElementById('quizActiveArea').classList.remove('hidden');
            }
        };

        function renderQuizQuestion() {
            if (currentQuizQuestions.length === 0) return;
            
            const question = currentQuizQuestions[currentQuizIndex];
            const currentAnswer = userAnswers[currentQuizIndex];
            
            document.getElementById('quizQuestion').innerText = question.otazka;
            document.getElementById('quizQuestionCounter').innerText = `Ot√°zka ${currentQuizIndex + 1}/${currentQuizQuestions.length}`;
            
            const progress = ((currentQuizIndex + 1) / currentQuizQuestions.length) * 100;
            document.getElementById('quizProgressFill').style.width = `${progress}%`;
            
            const correctCount = userAnswers.filter((ans, idx) => ans === currentQuizQuestions[idx]?.odpoved).length;
            document.getElementById('quizScore').innerText = `${correctCount}/${currentQuizQuestions.length} spr√°vnƒõ`;
            
            const options = question.quizOptions || generateQuizOptions(question.odpoved);
            
            const letters = ['A', 'B', 'C', 'D'];
            let optionsHtml = '';
            
            options.forEach((opt, idx) => {
                let optionClass = 'quiz-option';
                if (currentAnswer !== null) {
                    if (opt === question.odpoved) optionClass += ' correct';
                    else if (opt === currentAnswer && opt !== question.odpoved) optionClass += ' incorrect';
                    if (currentAnswer) optionClass += ' disabled';
                }
                
                optionsHtml += `
                    <div class="${optionClass}" onclick="${currentAnswer === null ? `selectQuizOption('${opt.replace(/'/g, "\\'")}')` : ''}">
                        <span class="option-letter">${letters[idx]}</span>
                        <span>${opt}</span>
                    </div>
                `;
            });
            
            document.getElementById('quizOptions').innerHTML = optionsHtml;
            
            document.getElementById('quizPrevBtn').disabled = currentQuizIndex === 0;
            document.getElementById('quizNextBtn').innerHTML = currentQuizIndex === currentQuizQuestions.length - 1 ? 
                'Dokonƒçit <i data-feather="check" class="w-4 h-4"></i>' : 
                'Dal≈°√≠ <i data-feather="arrow-right" class="w-4 h-4"></i>';
            
            feather.replace();
        }

        window.selectQuizOption = function(option) {
            userAnswers[currentQuizIndex] = option;
            renderQuizQuestion();
            
            if (currentQuizIndex < currentQuizQuestions.length - 1) {
                setTimeout(() => {
                    currentQuizIndex++;
                    renderQuizQuestion();
                }, 600);
            }
        };

        window.nextQuizQuestion = function() {
            if (currentQuizIndex < currentQuizQuestions.length - 1) {
                currentQuizIndex++;
                renderQuizQuestion();
            } else {
                showQuizResults(true);
            }
        };

        window.previousQuizQuestion = function() {
            if (currentQuizIndex > 0) {
                currentQuizIndex--;
                renderQuizQuestion();
            }
        };

        // ==================== HISTORIE ====================

        function renderQuizHistory() {
            const filter = document.getElementById('historyTimeFilter').value;
            let history = [...quizHistory].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (filter !== 'all') {
                const days = parseInt(filter);
                const cutoff = new Date();
                cutoff.setDate(cutoff.getDate() - days);
                history = history.filter(h => new Date(h.date) > cutoff);
            }
            
            renderHistoryChart(history);
            renderCategoryStats(history);
            renderRecentResults(history);
        }

        function renderHistoryChart(history) {
            const container = document.getElementById('chartContainer');
            
            if (history.length === 0) {
                container.innerHTML = '<div class="w-full text-center text-slate-500 py-8">≈Ω√°dn√° data k zobrazen√≠</div>';
                return;
            }
            
            const lastResults = history.slice(0, 10).reverse();
            
            let chartHtml = '';
            
            lastResults.forEach((result, index) => {
                const percentage = (result.score / result.total) * 100;
                const height = Math.max(10, (percentage / 100) * 160);
                const date = new Date(result.date).toLocaleDateString('cs-CZ', { day: '2-digit', month: '2-digit' });
                
                let color = 'bg-red-400';
                if (percentage >= 80) color = 'bg-green-400';
                else if (percentage >= 60) color = 'bg-emerald-400';
                else if (percentage >= 40) color = 'bg-yellow-400';
                else if (percentage >= 20) color = 'bg-orange-400';
                
                chartHtml += `
                    <div class="flex flex-col items-center flex-1">
                        <div class="w-full ${color} rounded-t-lg" style="height: ${height}px; min-height: 10px;"></div>
                        <div class="text-xs mt-1 text-slate-600">${date}</div>
                        <div class="text-xs font-semibold">${Math.round(percentage)}%</div>
                    </div>
                `;
            });
            
            container.innerHTML = chartHtml;
        }

        function renderCategoryStats(history) {
            if (history.length === 0) {
                document.getElementById('categoryStats').innerHTML = '<div class="text-center text-slate-500 py-4">Zat√≠m ≈æ√°dn√© v√Ωsledky</div>';
                return;
            }
            
            const categoryStats = {};
            
            history.forEach(result => {
                if (result.category) {
                    if (!categoryStats[result.category]) {
                        categoryStats[result.category] = { total: 0, correct: 0, count: 0 };
                    }
                    categoryStats[result.category].total += result.total;
                    categoryStats[result.category].correct += result.score;
                    categoryStats[result.category].count++;
                }
            });
            
            let html = '';
            for (const [category, stats] of Object.entries(categoryStats)) {
                const percentage = Math.round((stats.correct / stats.total) * 100);
                
                let barColor = 'bg-green-500';
                if (percentage < 60) barColor = 'bg-yellow-500';
                if (percentage < 40) barColor = 'bg-red-500';
                
                html += `
                    <div>
                        <div class="flex justify-between text-sm mb-1">
                            <span>${category}</span>
                            <span class="font-semibold">${percentage}%</span>
                        </div>
                        <div class="h-2 bg-slate-200 rounded-full overflow-hidden">
                            <div class="h-full ${barColor}" style="width: ${percentage}%"></div>
                        </div>
                        <div class="text-xs text-slate-500 mt-1">
                            ${stats.correct}/${stats.total} spr√°vnƒõ (${stats.count} kv√≠z≈Ø)
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('categoryStats').innerHTML = html;
        }

        function renderRecentResults(history) {
            if (history.length === 0) {
                document.getElementById('recentResults').innerHTML = '<div class="text-center text-slate-500 py-4">Zat√≠m ≈æ√°dn√© v√Ωsledky</div>';
                return;
            }
            
            const recent = history.slice(0, 10);
            
            let html = '';
            recent.forEach((result, index) => {
                const date = new Date(result.date).toLocaleDateString('cs-CZ', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const percentage = Math.round((result.score / result.total) * 100);
                let badgeColor = 'bg-green-100 text-green-700';
                let icon = 'check-circle';
                
                if (percentage < 60) {
                    badgeColor = 'bg-yellow-100 text-yellow-700';
                    icon = 'alert-circle';
                }
                if (percentage < 40) {
                    badgeColor = 'bg-red-100 text-red-700';
                    icon = 'x-circle';
                }
                
                html += `
                    <div class="flex items-center justify-between p-3 bg-slate-50 rounded-xl">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-lg ${badgeColor} flex items-center justify-center">
                                <i data-feather="${icon}" class="w-4 h-4"></i>
                            </div>
                            <div>
                                <div class="font-medium">${result.score}/${result.total}</div>
                                <div class="text-xs text-slate-500">${date}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-semibold ${percentage >= 60 ? 'text-green-600' : 'text-orange-600'}">${percentage}%</div>
                            <div class="text-xs text-slate-500">${result.category || 'V≈°e'}</div>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('recentResults').innerHTML = html;
            feather.replace();
        }

        window.clearQuizHistory = function() {
            showConfirm(
                'Smazat historii?',
                'V≈°echny ulo≈æen√© v√Ωsledky budou smaz√°ny.',
                () => {
                    quizHistory = [];
                    localStorage.setItem('psylab_quiz_history', JSON.stringify(quizHistory));
                    renderQuizHistory();
                    updateQuizHeader();
                    showToast('Historie smaz√°na');
                }
            );
        };

        // ==================== SPR√ÅVA FLASHCARDS ====================

        window.exportFlashcards = function() {
            const data = { 
                flashcards, 
                exportDate: new Date().toISOString(),
                type: 'flashcards'
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `flashcards-${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            showToast('Flashcards exportov√°ny');
        };

        window.importFlashcards = function(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (imported.flashcards && imported.type === 'flashcards') {
                        flashcards = imported.flashcards.map(f => ({
                            ...f,
                            id: Date.now() + Math.random(),
                            vaha: 0,
                            hodnoceni: []
                        }));
                        saveFlashcards();
                        showToast('Flashcards importov√°ny');
                    } else {
                        alert('Neplatn√Ω soubor flashcards');
                    }
                } catch (error) {
                    alert('Chyba p≈ôi importu');
                }
            };
            reader.readAsText(file);
        };

        window.filterFlashcards = function() {
            renderFlashcardsList();
        };

        function renderFlashcardsList() {
            const filter = document.getElementById('flashcardsFilter')?.value || 'all';
            const filtered = filter === 'all' ? flashcards : flashcards.filter(f => f.kategorie === filter);
            
            document.getElementById('flashcardsList').innerHTML = filtered.length ? filtered.map(f => {
                const statusIcon = f.vaha >= 3 ? 'check-circle' : f.vaha === 2 ? 'alert-circle' : f.vaha === 1 ? 'refresh-cw' : 'clock';
                const statusColor = f.vaha >= 3 ? 'text-green-500' : f.vaha === 2 ? 'text-orange-500' : 'text-blue-500';
                
                return `
                <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100">
                    <div class="flex items-start gap-3">
                        <input type="checkbox" class="card-checkbox flashcard-checkbox" data-id="${f.id}" onchange="toggleSelectFlashcard(${f.id}, this.checked)" ${selectedFlashcards.has(f.id) ? 'checked' : ''}>
                        <div class="flex-1">
                            <div class="flex justify-between items-start mb-2">
                                <div class="flex gap-2">
                                    <span class="category-tag"><i data-feather="folder"></i> ${f.kategorie}</span>
                                    <span class="status-badge ${statusColor}"><i data-feather="${statusIcon}"></i> V√°ha: ${f.vaha}</span>
                                </div>
                                <div class="flex gap-1">
                                    <button onclick='editFlashcard(${JSON.stringify(f).replace(/'/g, "\\'")})' class="p-2 bg-blue-50 rounded-lg"><i data-feather="edit-2" class="w-4 h-4 text-blue-500"></i></button>
                                    <button onclick="deleteFlashcard(${f.id})" class="p-2 bg-red-50 rounded-lg"><i data-feather="trash-2" class="w-4 h-4 text-red-500"></i></button>
                                </div>
                            </div>
                            <p class="font-medium mb-1">‚ùì ${f.otazka}</p>
                            <p class="text-sm text-slate-600">üí° ${f.odpoved}</p>
                        </div>
                    </div>
                </div>
            `}).join('') : '<div class="text-center py-8 text-slate-500">≈Ω√°dn√© flashcards</div>';
            
            feather.replace();
            updateFlashcardsSelectedCount();
        }

        window.editFlashcard = function(flashcard) {
            document.getElementById('modalTitle').innerText = 'Upravit flashcard';
            document.getElementById('modalItemType').value = 'flashcard';
            document.getElementById('modalItemId').value = flashcard.id;
            document.getElementById('modalQuestion').value = flashcard.otazka;
            document.getElementById('modalAnswer').value = flashcard.odpoved;
            document.getElementById('modalCategory').value = flashcard.kategorie;
            document.getElementById('modalQuizOptions').value = '';
            document.getElementById('answerField').classList.remove('hidden');
            document.getElementById('quizOptionsField').classList.add('hidden');
            document.getElementById('itemModal').style.display = 'flex';
        };

        window.deleteFlashcard = function(id) {
            showConfirm(
                'Smazat flashcard?',
                'Tuto akci nelze vr√°tit.',
                () => {
                    flashcards = flashcards.filter(f => f.id != id);
                    selectedFlashcards.delete(id);
                    saveFlashcards();
                    renderFlashcardsList();
                }
            );
        };

        window.toggleSelectAllFlashcards = function() {
            const checkbox = document.getElementById('flashcardsSelectAll');
            const cards = document.querySelectorAll('.flashcard-checkbox');
            
            cards.forEach(card => {
                card.checked = checkbox.checked;
                if (checkbox.checked) {
                    selectedFlashcards.add(parseInt(card.dataset.id));
                } else {
                    selectedFlashcards.delete(parseInt(card.dataset.id));
                }
            });
            
            updateFlashcardsSelectedCount();
        };

        window.toggleSelectFlashcard = function(id, checked) {
            if (checked) {
                selectedFlashcards.add(id);
            } else {
                selectedFlashcards.delete(id);
                document.getElementById('flashcardsSelectAll').checked = false;
            }
            updateFlashcardsSelectedCount();
        };

        function updateFlashcardsSelectedCount() {
            document.getElementById('flashcardsSelectedCount').innerText = `${selectedFlashcards.size} vybr√°no`;
        }

        window.resetSelectedFlashcards = function() {
            if (selectedFlashcards.size === 0) {
                showToast('≈Ω√°dn√© flashcards nevybr√°ny');
                return;
            }
            
            showConfirm(
                'Resetovat vybran√©?',
                `${selectedFlashcards.size} flashcards bude m√≠t v√°hu 0.`,
                () => {
                    flashcards.forEach(f => {
                        if (selectedFlashcards.has(f.id)) {
                            f.vaha = 0;
                            f.hodnoceni = [];
                        }
                    });
                    saveFlashcards();
                    selectedFlashcards.clear();
                    document.getElementById('flashcardsSelectAll').checked = false;
                    showToast('Vybran√© flashcards resetov√°ny');
                }
            );
        };

        window.deleteSelectedFlashcards = function() {
            if (selectedFlashcards.size === 0) {
                showToast('≈Ω√°dn√© flashcards nevybr√°ny');
                return;
            }
            
            showConfirm(
                'Smazat vybran√©?',
                `${selectedFlashcards.size} flashcards bude smaz√°no.`,
                () => {
                    flashcards = flashcards.filter(f => !selectedFlashcards.has(f.id));
                    selectedFlashcards.clear();
                    document.getElementById('flashcardsSelectAll').checked = false;
                    saveFlashcards();
                    renderFlashcardsList();
                    showToast('Vybran√© flashcards smaz√°ny');
                }
            );
        };

        // ==================== SPR√ÅVA Kv√≠z≈Ø ====================

        window.exportQuiz = function() {
            const data = { 
                quizQuestions, 
                exportDate: new Date().toISOString(),
                type: 'quiz'
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `quiz-${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            showToast('Kv√≠zov√© ot√°zky exportov√°ny');
        };

        window.importQuiz = function(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (imported.quizQuestions && imported.type === 'quiz') {
                        quizQuestions = imported.quizQuestions.map(q => ({
                            ...q,
                            id: Date.now() + Math.random()
                        }));
                        saveQuiz();
                        showToast('Kv√≠zov√© ot√°zky importov√°ny');
                    } else {
                        alert('Neplatn√Ω soubor kv√≠zu');
                    }
                } catch (error) {
                    alert('Chyba p≈ôi importu');
                }
            };
            reader.readAsText(file);
        };

        window.filterQuiz = function() {
            renderQuizList();
        };

        function renderQuizList() {
            const filter = document.getElementById('quizFilter')?.value || 'all';
            const filtered = filter === 'all' ? quizQuestions : quizQuestions.filter(q => q.kategorie === filter);
            
            document.getElementById('quizList').innerHTML = filtered.length ? filtered.map(q => {
                return `
                <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100">
                    <div class="flex items-start gap-3">
                        <input type="checkbox" class="card-checkbox quiz-checkbox" data-id="${q.id}" onchange="toggleSelectQuiz(${q.id}, this.checked)" ${selectedQuiz.has(q.id) ? 'checked' : ''}>
                        <div class="flex-1">
                            <div class="flex justify-between items-start mb-2">
                                <div class="flex gap-2">
                                    <span class="category-tag"><i data-feather="folder"></i> ${q.kategorie}</span>
                                    ${q.quizOptions ? '<span class="status-badge bg-green-100 text-green-600"><i data-feather="check"></i> Vlastn√≠ mo≈ænosti</span>' : ''}
                                </div>
                                <div class="flex gap-1">
                                    <button onclick='editQuiz(${JSON.stringify(q).replace(/'/g, "\\'")})' class="p-2 bg-blue-50 rounded-lg"><i data-feather="edit-2" class="w-4 h-4 text-blue-500"></i></button>
                                    <button onclick="deleteQuiz(${q.id})" class="p-2 bg-red-50 rounded-lg"><i data-feather="trash-2" class="w-4 h-4 text-red-500"></i></button>
                                </div>
                            </div>
                            <p class="font-medium mb-1">‚ùì ${q.otazka}</p>
                            <p class="text-sm text-green-600 font-medium">‚úì ${q.odpoved}</p>
                        </div>
                    </div>
                </div>
            `}).join('') : '<div class="text-center py-8 text-slate-500">≈Ω√°dn√© kv√≠zov√© ot√°zky</div>';
            
            feather.replace();
            updateQuizSelectedCount();
        }

        window.editQuiz = function(question) {
            document.getElementById('modalTitle').innerText = 'Upravit ot√°zku';
            document.getElementById('modalItemType').value = 'quiz';
            document.getElementById('modalItemId').value = question.id;
            document.getElementById('modalQuestion').value = question.otazka;
            document.getElementById('modalAnswer').value = question.odpoved;
            document.getElementById('modalCategory').value = question.kategorie;
            document.getElementById('modalQuizOptions').value = question.quizOptions ? question.quizOptions.join('; ') : '';
            document.getElementById('answerField').classList.remove('hidden');
            document.getElementById('quizOptionsField').classList.remove('hidden');
            document.getElementById('itemModal').style.display = 'flex';
        };

        window.deleteQuiz = function(id) {
            showConfirm(
                'Smazat ot√°zku?',
                'Tuto akci nelze vr√°tit.',
                () => {
                    quizQuestions = quizQuestions.filter(q => q.id != id);
                    selectedQuiz.delete(id);
                    saveQuiz();
                    renderQuizList();
                }
            );
        };

        window.toggleSelectAllQuiz = function() {
            const checkbox = document.getElementById('quizSelectAll');
            const cards = document.querySelectorAll('.quiz-checkbox');
            
            cards.forEach(card => {
                card.checked = checkbox.checked;
                if (checkbox.checked) {
                    selectedQuiz.add(parseInt(card.dataset.id));
                } else {
                    selectedQuiz.delete(parseInt(card.dataset.id));
                }
            });
            
            updateQuizSelectedCount();
        };

        window.toggleSelectQuiz = function(id, checked) {
            if (checked) {
                selectedQuiz.add(id);
            } else {
                selectedQuiz.delete(id);
                document.getElementById('quizSelectAll').checked = false;
            }
            updateQuizSelectedCount();
        };

        function updateQuizSelectedCount() {
            document.getElementById('quizSelectedCount').innerText = `${selectedQuiz.size} vybr√°no`;
        }

        window.deleteSelectedQuiz = function() {
            if (selectedQuiz.size === 0) {
                showToast('≈Ω√°dn√© ot√°zky nevybr√°ny');
                return;
            }
            
            showConfirm(
                'Smazat vybran√©?',
                `${selectedQuiz.size} ot√°zek bude smaz√°no.`,
                () => {
                    quizQuestions = quizQuestions.filter(q => !selectedQuiz.has(q.id));
                    selectedQuiz.clear();
                    document.getElementById('quizSelectAll').checked = false;
                    saveQuiz();
                    renderQuizList();
                    showToast('Vybran√© ot√°zky smaz√°ny');
                }
            );
        };

        // ==================== KATEGORIE ====================

        window.openCategoryModal = function() {
            renderCategoriesList();
            document.getElementById('categoryModal').style.display = 'flex';
        };

        window.closeCategoryModal = function() {
            document.getElementById('categoryModal').style.display = 'none';
        };

        window.addCategory = function() {
            const name = document.getElementById('newCategoryName').value.trim();
            if (!name) return alert('Zadejte n√°zev');
            if (kategorie.includes(name)) return alert('Kategorie ji≈æ existuje');
            
            kategorie.push(name);
            localStorage.setItem('psylab_categories', JSON.stringify(kategorie));
            
            updateCategorySelects();
            renderCategoriesList();
            document.getElementById('newCategoryName').value = '';
            showToast('Kategorie p≈ôid√°na');
        };

        window.confirmDeleteCategory = function(name) {
            const flashcardsCount = flashcards.filter(f => f.kategorie === name).length;
            const quizCount = quizQuestions.filter(q => q.kategorie === name).length;
            const total = flashcardsCount + quizCount;
            
            categoryToDelete = name;
            
            showConfirm(
                'Smazat kategorii?',
                `Kategorie "${name}" obsahuje ${total} polo≈æek (${flashcardsCount} flashcards, ${quizCount} kv√≠z≈Ø). V≈°e bude smaz√°no.`,
                () => {
                    flashcards = flashcards.filter(f => f.kategorie !== categoryToDelete);
                    quizQuestions = quizQuestions.filter(q => q.kategorie !== categoryToDelete);
                    kategorie = kategorie.filter(k => k !== categoryToDelete);
                    
                    localStorage.setItem('psylab_flashcards', JSON.stringify(flashcards));
                    localStorage.setItem('psylab_quiz', JSON.stringify(quizQuestions));
                    localStorage.setItem('psylab_categories', JSON.stringify(kategorie));
                    
                    updateCategorySelects();
                    renderCategoriesList();
                    updateFlashcardsUI();
                    updateQuizUI();
                    closeCategoryModal();
                    showToast('Kategorie smaz√°na');
                }
            );
        };

        function updateCategorySelects() {
            const options = '<option value="all">V≈°echny</option>' + kategorie.map(k => `<option value="${k}">${k}</option>`).join('');
            
            document.getElementById('flashcardsLearnFilter').innerHTML = options;
            document.getElementById('flashcardsFilter').innerHTML = options;
            document.getElementById('quizCategoryFilter').innerHTML = options;
            document.getElementById('quizFilter').innerHTML = options;
            document.getElementById('modalCategory').innerHTML = kategorie.map(k => `<option value="${k}">${k}</option>`).join('');
        }

        function renderCategoriesList() {
            document.getElementById('categoriesList').innerHTML = kategorie.map(k => {
                const flashcardsCount = flashcards.filter(f => f.kategorie === k).length;
                const quizCount = quizQuestions.filter(q => q.kategorie === k).length;
                
                return `
                <div class="flex justify-between items-center bg-slate-50 p-4 rounded-xl">
                    <div>
                        <span class="font-medium">${k}</span>
                        <div class="text-xs text-slate-500 mt-1">
                            <span class="mr-2">üìá ${flashcardsCount}</span>
                            <span>‚ùì ${quizCount}</span>
                        </div>
                    </div>
                    <button onclick="confirmDeleteCategory('${k}')" class="p-2 bg-red-50 rounded-lg">
                        <i data-feather="trash-2" class="w-4 h-4 text-red-500"></i>
                    </button>
                </div>
            `}).join('');
            feather.replace();
        }

        // ==================== SPOLEƒåN√â ====================

        window.openAddModal = function(type = 'flashcard') {
            document.getElementById('modalTitle').innerText = type === 'flashcard' ? 'Nov√° flashcard' : 'Nov√° kv√≠zov√° ot√°zka';
            document.getElementById('modalItemType').value = type;
            document.getElementById('modalItemId').value = '';
            document.getElementById('modalQuestion').value = '';
            document.getElementById('modalAnswer').value = '';
            document.getElementById('modalQuizOptions').value = '';
            document.getElementById('modalCategory').value = kategorie[0];
            
            if (type === 'quiz') {
                document.getElementById('answerField').classList.remove('hidden');
                document.getElementById('quizOptionsField').classList.remove('hidden');
            } else {
                document.getElementById('answerField').classList.remove('hidden');
                document.getElementById('quizOptionsField').classList.add('hidden');
            }
            
            document.getElementById('itemModal').style.display = 'flex';
        };

        window.closeItemModal = function() {
            document.getElementById('itemModal').style.display = 'none';
        };

        window.saveItem = function() {
            const type = document.getElementById('modalItemType').value;
            const id = document.getElementById('modalItemId').value;
            const question = document.getElementById('modalQuestion').value;
            const answer = document.getElementById('modalAnswer').value;
            const category = document.getElementById('modalCategory').value;
            
            if (!question || !answer) {
                alert('Vypl≈àte ot√°zku a odpovƒõƒè');
                return;
            }
            
            if (type === 'flashcard') {
                if (id) {
                    const f = flashcards.find(f => f.id == id);
                    if (f) {
                        f.otazka = question;
                        f.odpoved = answer;
                        f.kategorie = category;
                    }
                } else {
                    flashcards.push({
                        id: Date.now(),
                        otazka: question,
                        odpoved: answer,
                        kategorie: category,
                        vaha: 0,
                        hodnoceni: []
                    });
                }
                saveFlashcards();
            } else {
                const quizOptionsText = document.getElementById('modalQuizOptions').value;
                let quizOptions = [];
                if (quizOptionsText.trim()) {
                    quizOptions = quizOptionsText.split(';').map(opt => opt.trim()).filter(opt => opt);
                }
                
                if (id) {
                    const q = quizQuestions.find(q => q.id == id);
                    if (q) {
                        q.otazka = question;
                        q.odpoved = answer;
                        q.kategorie = category;
                        if (quizOptions.length > 0) q.quizOptions = quizOptions;
                    }
                } else {
                    quizQuestions.push({
                        id: Date.now(),
                        otazka: question,
                        odpoved: answer,
                        kategorie: category,
                        quizOptions: quizOptions.length > 0 ? quizOptions : null
                    });
                }
                saveQuiz();
            }
            
            closeItemModal();
            showToast('Ulo≈æeno');
        };

        function showToast(msg) {
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-8 left-1/2 -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-2xl shadow-xl z-50 flex items-center gap-2 animate-slide-up';
            toast.innerHTML = `<i data-feather="check-circle" class="w-5 h-5 text-green-400"></i><span>${msg}</span>`;
            document.body.appendChild(toast);
            feather.replace();
            setTimeout(() => toast.remove(), 2000);
        }

        function showConfirm(title, message, onConfirm) {
            document.getElementById('confirmTitle').innerText = title;
            document.getElementById('confirmMessage').innerHTML = message;
            document.getElementById('confirmModal').style.display = 'flex';
            confirmAction = onConfirm;
        }

        window.closeConfirmModal = function() {
            document.getElementById('confirmModal').style.display = 'none';
            confirmAction = null;
        };

        window.executeConfirmedAction = function() {
            if (confirmAction) {
                confirmAction();
                closeConfirmModal();
            }
        };

        // Click outside
        document.getElementById('itemModal').addEventListener('click', e => e.target === document.getElementById('itemModal') && closeItemModal());
        document.getElementById('categoryModal').addEventListener('click', e => e.target === document.getElementById('categoryModal') && closeCategoryModal());
        document.getElementById('confirmModal').addEventListener('click', e => e.target === document.getElementById('confirmModal') && closeConfirmModal());

        // Inicializace
        (function init() {
            if (flashcards.length === 0) {
                flashcards = [
                    { id: 1, otazka: "Kdo byl Sigmund Freud?", odpoved: "Zakladatel psychoanal√Ωzy", kategorie: "Obecn√°", vaha: 0, hodnoceni: [] },
                    { id: 2, otazka: "Co je behaviorismus?", odpoved: "Smƒõr zamƒõ≈ôen√Ω na chov√°n√≠", kategorie: "Obecn√°", vaha: 0, hodnoceni: [] }
                ];
            }
            
            if (quizQuestions.length === 0) {
                quizQuestions = [
                    { 
                        id: 101, 
                        otazka: "Kdo je autorem teorie kognitivn√≠ho v√Ωvoje?", 
                        odpoved: "Jean Piaget", 
                        kategorie: "V√Ωvojov√°",
                        quizOptions: ["Jean Piaget", "Sigmund Freud", "Lev Vygotsky", "Erik Erikson"]
                    },
                    { 
                        id: 102, 
                        otazka: "Kter√Ω typ pamƒõti uchov√°v√° informace nejd√©le?", 
                        odpoved: "Dlouhodob√° pamƒõ≈•", 
                        kategorie: "Obecn√°",
                        quizOptions: ["Dlouhodob√° pamƒõ≈•", "Kr√°tkodob√° pamƒõ≈•", "Senzorick√° pamƒõ≈•", "Pracovn√≠ pamƒõ≈•"]
                    }
                ];
            }
            
            updateCategorySelects();
            updateFlashcardsUI();
            updateQuizUI();
            renderCategoriesList();
        })();
    </script>
</body>
</html>
