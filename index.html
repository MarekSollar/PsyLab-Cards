<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>PsyLab Flashcards</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #f8fafc;
        }
        
        .perspective {
            perspective: 2000px;
        }
        
        .preserve-3d {
            transform-style: preserve-3d;
        }
        
        .backface-hidden {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }
        
        .rotate-y-180 {
            transform: rotateY(180deg);
        }
        
        .card-transition {
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .animate-slide-up {
            animation: slideUp 0.4s ease-out forwards;
        }
        
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #0ea5e9 0%, #a855f7 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .category-tag {
            background: #f0f9ff;
            color: #0369a1;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .tab {
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            font-weight: 500;
            transition: all 0.2s;
            color: #64748b;
        }
        
        .tab.active {
            background: white;
            color: #0ea5e9;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #0ea5e9 0%, #a855f7 100%);
            color: white;
            border-radius: 1rem;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            transition: all 0.2s;
            box-shadow: 0 10px 15px -3px rgba(14, 165, 233, 0.2);
        }
        
        .btn-primary:active {
            transform: scale(0.96);
            box-shadow: 0 4px 6px -1px rgba(14, 165, 233, 0.3);
        }
        
        .btn-secondary {
            background: white;
            color: #0ea5e9;
            border: 1px solid #e2e8f0;
            border-radius: 1rem;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .btn-secondary:active {
            background: #f8fafc;
            transform: scale(0.96);
        }
        
        .modal {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
        }
        
        .confirm-modal {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(12px);
        }
        
        .rating-btn {
            border-radius: 1rem;
            padding: 1rem;
            font-weight: 500;
            transition: all 0.2s;
            border: 1px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }
        
        .rating-btn:active {
            transform: scale(0.94);
        }
        
        .rating-btn i {
            width: 24px;
            height: 24px;
        }
        
        .card-front, .card-back {
            border-radius: 1.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .card-front {
            background: white;
            border: 1px solid #e2e8f0;
        }
        
        .card-back {
            background: linear-gradient(135deg, #f0f9ff 0%, #faf5ff 100%);
            border: 1px solid #bae6fd;
        }
    </style>
</head>
<body class="min-h-screen p-4 pb-24">

    <div class="max-w-md mx-auto">
        
        <!-- Header - MindBloom styl -->
        <div class="flex items-center justify-between mb-6 animate-slide-up">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 gradient-bg rounded-2xl flex items-center justify-center shadow-lg animate-float">
                    <i data-feather="layers" class="w-6 h-6 text-white"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-slate-800">PsyLab</h1>
                    <p class="text-sm text-slate-500">Flashcards ‚Ä¢ <span id="statsText">0/0</span></p>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="openCategoryModal()" class="w-12 h-12 bg-white rounded-2xl shadow-md flex items-center justify-center hover:shadow-lg active:scale-95 transition-all border border-slate-100">
                    <i data-feather="tag" class="w-5 h-5 text-purple-500"></i>
                </button>
                <button onclick="openCardModal()" class="w-12 h-12 gradient-bg rounded-2xl shadow-md flex items-center justify-center hover:shadow-lg active:scale-95 transition-all">
                    <i data-feather="plus" class="w-5 h-5 text-white"></i>
                </button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="glass-effect rounded-2xl p-1 mb-6 animate-slide-up" style="animation-delay: 0.1s">
            <div class="flex gap-1">
                <button onclick="switchTab('learn')" id="tabLearn" class="tab flex-1 active">
                    <i data-feather="book-open" class="w-4 h-4 inline mr-2"></i>
                    Uƒçen√≠
                </button>
                <button onclick="switchTab('manage')" id="tabManage" class="tab flex-1">
                    <i data-feather="edit-3" class="w-4 h-4 inline mr-2"></i>
                    Spr√°va
                </button>
            </div>
        </div>

        <!-- Progress Section (Learn tab) -->
        <div id="progressSection" class="gradient-bg rounded-2xl p-5 text-white shadow-xl mb-6 animate-slide-up" style="animation-delay: 0.15s">
            <div class="flex items-center justify-between mb-3">
                <div>
                    <p class="text-white/80 text-sm">Denn√≠ pokrok</p>
                    <p class="text-2xl font-bold"><span id="kUceni">0</span> k uƒçen√≠</p>
                </div>
                <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm">
                    <i data-feather="trending-up" class="w-6 h-6 text-white"></i>
                </div>
            </div>
            <div class="h-2 bg-white/30 rounded-full overflow-hidden">
                <div id="progressBar" class="h-full bg-white rounded-full" style="width: 0%"></div>
            </div>
            <div class="flex justify-between mt-3 text-sm text-white/80">
                <span>Nauƒçeno: <span class="font-bold text-white" id="naucedo">0</span></span>
                <span>Celkem: <span class="font-bold text-white" id="celkemKaret">0</span></span>
            </div>
        </div>

        <!-- LEARN TAB -->
        <div id="learnTab">
            <!-- Empty state -->
            <div id="emptyState" class="text-center py-12 bg-white rounded-3xl shadow-sm border border-slate-100 animate-slide-up hidden">
                <div class="w-24 h-24 bg-slate-100 rounded-3xl flex items-center justify-center mx-auto mb-4">
                    <i data-feather="book" class="w-12 h-12 text-slate-400"></i>
                </div>
                <h2 class="text-xl font-semibold text-slate-700 mb-2">≈Ω√°dn√© kartiƒçky</h2>
                <p class="text-slate-500 mb-6">P≈ôidejte svou prvn√≠ kartiƒçku a zaƒçnƒõte se uƒçit</p>
                <button onclick="openCardModal()" class="btn-primary inline-flex items-center gap-2">
                    <i data-feather="plus" class="w-4 h-4"></i>
                    P≈ôidat kartiƒçku
                </button>
            </div>

            <!-- Flashcard area -->
            <div id="kartaArea" class="hidden">
                <!-- Card metadata -->
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center gap-2">
                        <span class="category-tag" id="kartaKategorie">
                            <i data-feather="folder" class="w-3 h-3"></i>
                            <span>Obecn√° psychologie</span>
                        </span>
                        <span class="text-sm bg-orange-100 text-orange-600 px-3 py-1 rounded-full flex items-center gap-1" id="kartaStatus">
                            <i data-feather="clock" class="w-3 h-3"></i>
                            Nov√°
                        </span>
                    </div>
                    <span class="text-sm text-slate-500" id="pocitadlo">1/5</span>
                </div>

                <!-- Flashcard 3D -->
                <div class="perspective mb-6" onclick="otocKartu()">
                    <div id="flashcard" class="relative w-full preserve-3d card-transition" style="min-height: 320px;">
                        <!-- Front -->
                        <div class="absolute w-full h-full backface-hidden card-front p-6 flex flex-col">
                            <div class="flex-1 flex items-center justify-center">
                                <p class="text-xl font-medium text-slate-800 text-center leading-relaxed" id="otazkaText"></p>
                            </div>
                            <div class="text-center text-slate-400 text-sm flex items-center justify-center gap-1">
                                <i data-feather="mouse-pointer" class="w-3 h-3"></i>
                                Klepnƒõte pro otoƒçen√≠
                            </div>
                        </div>
                        
                        <!-- Back -->
                        <div class="absolute w-full h-full backface-hidden rotate-y-180 card-back p-6 flex flex-col">
                            <div class="flex-1 flex items-center justify-center overflow-y-auto">
                                <p class="text-lg text-slate-700 text-center leading-relaxed" id="odpovedText"></p>
                            </div>
                            <div class="text-center text-primary-400 text-sm flex items-center justify-center gap-1">
                                <i data-feather="mouse-pointer" class="w-3 h-3"></i>
                                Zpƒõt na ot√°zku
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Rating buttons - MindBloom styl -->
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="hodnotit(1)" class="rating-btn" style="background: #dcfce7; color: #166534; border-color: #bbf7d0;">
                        <i data-feather="thumbs-up" class="text-emerald-600"></i>
                        <span>Ano</span>
                    </button>
                    <button onclick="hodnotit(2)" class="rating-btn" style="background: #dbeafe; color: #1e40af; border-color: #bfdbfe;">
                        <i data-feather="thumbs-up" class="text-blue-600"></i>
                        <span>Sp√≠≈°e ano</span>
                    </button>
                    <button onclick="hodnotit(3)" class="rating-btn" style="background: #fed7aa; color: #9a3412; border-color: #fdba74;">
                        <i data-feather="thumbs-down" class="text-orange-600"></i>
                        <span>Sp√≠≈°e ne</span>
                    </button>
                    <button onclick="hodnotit(4)" class="rating-btn" style="background: #fee2e2; color: #991b1b; border-color: #fecaca;">
                        <i data-feather="thumbs-down" class="text-red-600"></i>
                        <span>Ne</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- MANAGE TAB -->
        <div id="manageTab" class="hidden">
            <!-- Filter -->
            <div class="mb-4 animate-slide-up">
                <select id="categoryFilter" onchange="filterCards()" class="w-full p-4 bg-white rounded-2xl border border-slate-200 shadow-sm">
                    <option value="all">V≈°echny kategorie</option>
                </select>
            </div>

            <!-- Cards list -->
            <div id="cardsList" class="space-y-3">
                <!-- Dynamically populated -->
            </div>
        </div>
    </div>

    <!-- MODAL pro kartu -->
    <div id="cardModal" class="fixed inset-0 modal hidden items-end justify-center p-4 z-50" style="display: none;">
        <div class="bg-white rounded-3xl w-full max-w-md p-6 shadow-2xl animate-slide-up">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-slate-800" id="cardModalTitle">
                    <i data-feather="edit-3" class="w-5 h-5 inline mr-2 text-primary-500"></i>
                    Nov√° kartiƒçka
                </h3>
                <button onclick="closeCardModal()" class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center hover:bg-slate-200 transition-colors">
                    <i data-feather="x" class="w-5 h-5 text-slate-500"></i>
                </button>
            </div>
            
            <input type="hidden" id="editCardId">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Ot√°zka</label>
                    <input type="text" id="cardQuestion" placeholder="Nap≈ô. Kdo byl Sigmund Freud?" class="w-full p-4 bg-slate-50 rounded-xl border border-slate-200 focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Odpovƒõƒè</label>
                    <textarea id="cardAnswer" placeholder="Nap≈ô. Zakladatel psychoanal√Ωzy" rows="3" class="w-full p-4 bg-slate-50 rounded-xl border border-slate-200 focus:ring-2 focus:ring-primary-500 focus:border-transparent"></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Kategorie</label>
                    <select id="cardCategory" class="w-full p-4 bg-slate-50 rounded-xl border border-slate-200 focus:ring-2 focus:ring-primary-500"></select>
                </div>
                
                <button onclick="saveCard()" class="btn-primary w-full py-4 mt-4">
                    <i data-feather="check" class="w-4 h-4 inline mr-2"></i>
                    Ulo≈æit kartiƒçku
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL pro kategorie -->
    <div id="categoryModal" class="fixed inset-0 modal hidden items-end justify-center p-4 z-50" style="display: none;">
        <div class="bg-white rounded-3xl w-full max-w-md p-6 shadow-2xl animate-slide-up">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-slate-800">
                    <i data-feather="tag" class="w-5 h-5 inline mr-2 text-purple-500"></i>
                    Spr√°va kategori√≠
                </h3>
                <button onclick="closeCategoryModal()" class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center hover:bg-slate-200">
                    <i data-feather="x" class="w-5 h-5 text-slate-500"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <!-- Add category -->
                <div class="flex gap-2">
                    <input type="text" id="newCategoryName" placeholder="Nov√° kategorie" class="flex-1 p-4 bg-slate-50 rounded-xl border border-slate-200">
                    <button onclick="addCategory()" class="w-14 h-14 gradient-bg rounded-xl flex items-center justify-center shadow-md hover:shadow-lg active:scale-95 transition-all">
                        <i data-feather="plus" class="w-5 h-5 text-white"></i>
                    </button>
                </div>
                
                <!-- Categories list -->
                <div id="categoriesList" class="space-y-2 max-h-96 overflow-y-auto">
                    <!-- Dynamically populated -->
                </div>
            </div>
        </div>
    </div>

    <!-- CONFIRM MODAL pro maz√°n√≠ kategorie s obsahem -->
    <div id="confirmModal" class="fixed inset-0 confirm-modal hidden items-center justify-center p-4 z-[60]" style="display: none;">
        <div class="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl animate-slide-up">
            <div class="w-16 h-16 bg-red-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <i data-feather="alert-triangle" class="w-8 h-8 text-red-500"></i>
            </div>
            
            <h3 class="text-xl font-bold text-slate-800 text-center mb-2">Smazat kategorii?</h3>
            <p class="text-slate-600 text-center mb-6" id="confirmMessage">Tato kategorie obsahuje X kartiƒçek. Budou tak√© smaz√°ny.</p>
            
            <div class="flex gap-3">
                <button onclick="closeConfirmModal()" class="btn-secondary flex-1">Zpƒõt</button>
                <button onclick="executeDeleteCategory()" class="flex-1 bg-red-500 text-white py-4 rounded-xl font-medium hover:bg-red-600 active:scale-95 transition-all">
                    Ano, smazat v≈°e
                </button>
            </div>
        </div>
    </div>

    <script>
        // Inicializace feather icons
        feather.replace();

        // Data
        const DEFAULT_CATEGORIES = ['Obecn√° psychologie', 'V√Ωvojov√° psychologie', 'Klinick√° psychologie', 'Soci√°ln√≠ psychologie'];
        
        let karticky = JSON.parse(localStorage.getItem('karticky')) || [];
        let kategorie = JSON.parse(localStorage.getItem('kategorie')) || DEFAULT_CATEGORIES;

        let aktualniKarta = null;
        let otoceno = false;
        let kUCeni = [];
        let kategorieKeSmazani = null;

        // Inicializace
        function init() {
            if (karticky.length === 0) {
                karticky = [
                    { id: 1, otazka: "Kdo byl Sigmund Freud?", odpoved: "Zakladatel psychoanal√Ωzy", kategorie: "Obecn√° psychologie", vaha: 0, hodnoceni: [] },
                    { id: 2, otazka: "Co je to behaviorismus?", odpoved: "Psychologick√Ω smƒõr zamƒõ≈ôen√Ω na pozorovateln√© chov√°n√≠", kategorie: "Obecn√° psychologie", vaha: 0, hodnoceni: [] },
                    { id: 3, otazka: "Kdo provedl experiment s mal√Ωm Albertem?", odpoved: "John B. Watson", kategorie: "Obecn√° psychologie", vaha: 0, hodnoceni: [] }
                ];
            }
            ulozData();
            aktualizujUI();
            renderCategoriesList();
            renderCardsList();
        }

        function ulozData() {
            localStorage.setItem('karticky', JSON.stringify(karticky));
            localStorage.setItem('kategorie', JSON.stringify(kategorie));
            aktualizujSelecty();
            aktualizujUI();
        }

        function aktualizujSelecty() {
            const select = document.getElementById('cardCategory');
            if (select) {
                select.innerHTML = kategorie.map(k => `<option value="${k}">${k}</option>`).join('');
            }
            
            const filter = document.getElementById('categoryFilter');
            if (filter) {
                filter.innerHTML = '<option value="all">V≈°echny kategorie</option>' + 
                    kategorie.map(k => `<option value="${k}">${k}</option>`).join('');
            }
        }

        function aktualizujUI() {
            kUCeni = karticky.filter(k => k.vaha < 3);
            
            const celkem = karticky.length;
            const nauceno = karticky.filter(k => k.vaha >= 3).length;
            
            document.getElementById('statsText').innerText = `${nauceno}/${celkem}`;
            document.getElementById('kUceni').innerText = kUCeni.length;
            document.getElementById('naucedo').innerText = nauceno;
            document.getElementById('celkemKaret').innerText = celkem;
            
            const procenta = celkem > 0 ? (nauceno / celkem) * 100 : 0;
            document.getElementById('progressBar').style.width = procenta + '%';
            
            if (celkem === 0) {
                document.getElementById('emptyState').classList.remove('hidden');
                document.getElementById('kartaArea').classList.add('hidden');
            } else {
                document.getElementById('emptyState').classList.add('hidden');
                document.getElementById('kartaArea').classList.remove('hidden');
                if (kUCeni.length > 0) {
                    vyberNahodnouKartu();
                } else {
                    document.getElementById('otazkaText').innerText = "V≈°echny kartiƒçky jsou nauƒçen√©! üéâ";
                    document.getElementById('odpovedText').innerText = "Gratulujeme! Dnes m√°te hotovo.";
                    document.getElementById('kartaStatus').innerHTML = '<i data-feather="check-circle" class="w-3 h-3"></i> Hotovo';
                    document.getElementById('kartaKategorie').innerHTML = '<i data-feather="star" class="w-3 h-3"></i> <span>V√Ωbornƒõ</span>';
                    feather.replace();
                }
            }
            
            renderCardsList();
        }

        function vyberNahodnouKartu() {
            if (kUCeni.length === 0) return;
            
            const vahy = kUCeni.map(k => 3 - k.vaha);
            const soucetVah = vahy.reduce((a, b) => a + b, 0);
            
            let nahodne = Math.random() * soucetVah;
            let vybrana = kUCeni[0];
            
            for (let i = 0; i < kUCeni.length; i++) {
                if (nahodne < (3 - kUCeni[i].vaha)) {
                    vybrana = kUCeni[i];
                    break;
                }
                nahodne -= (3 - kUCeni[i].vaha);
            }
            
            aktualniKarta = vybrana;
            otoceno = false;
            
            document.getElementById('otazkaText').innerText = vybrana.otazka;
            document.getElementById('odpovedText').innerText = vybrana.odpoved;
            document.getElementById('odpovedText').classList.add('hidden');
            document.getElementById('otazkaText').classList.remove('hidden');
            document.getElementById('kartaKategorie').innerHTML = `<i data-feather="folder" class="w-3 h-3"></i> <span>${vybrana.kategorie}</span>`;
            
            const index = kUCeni.findIndex(k => k.id === vybrana.id) + 1;
            document.getElementById('pocitadlo').innerText = `${index} / ${kUCeni.length}`;
            
            let statusText = '', statusIcon = '';
            if (vybrana.vaha === 0) { statusText = 'Nov√°'; statusIcon = 'clock'; }
            else if (vybrana.vaha === 1) { statusText = 'Opakov√°n√≠'; statusIcon = 'refresh-cw'; }
            else if (vybrana.vaha === 2) { statusText = 'T√©mƒõ≈ô nauƒçeno'; statusIcon = 'alert-circle'; }
            
            document.getElementById('kartaStatus').innerHTML = `<i data-feather="${statusIcon}" class="w-3 h-3"></i> ${statusText}`;
            
            feather.replace();
        }

        window.otocKartu = function() {
            if (!aktualniKarta) return;
            
            const flashcard = document.getElementById('flashcard');
            flashcard.classList.toggle('rotate-y-180');
            otoceno = !otoceno;
        };

        window.hodnotit = function(hodnoceni) {
            if (!aktualniKarta) return;
            
            let zmena = 0;
            switch(hodnoceni) {
                case 1: zmena = 1; break;
                case 2: zmena = 0.5; break;
                case 3: zmena = -0.5; break;
                case 4: zmena = -1; break;
            }
            
            aktualniKarta.vaha = Math.max(0, Math.min(4, aktualniKarta.vaha + zmena));
            aktualniKarta.hodnoceni.push({
                hodnoceni: hodnoceni,
                cas: new Date().toISOString()
            });
            
            ulozData();
            vyberNahodnouKartu();
        };

        // Spr√°va karet
        window.openCardModal = function(karta = null) {
            document.getElementById('cardModalTitle').innerHTML = `<i data-feather="${karta ? 'edit-3' : 'plus'}" class="w-5 h-5 inline mr-2 text-primary-500"></i> ${karta ? 'Upravit kartu' : 'Nov√° kartiƒçka'}`;
            
            if (karta) {
                document.getElementById('editCardId').value = karta.id;
                document.getElementById('cardQuestion').value = karta.otazka;
                document.getElementById('cardAnswer').value = karta.odpoved;
                document.getElementById('cardCategory').value = karta.kategorie;
            } else {
                document.getElementById('editCardId').value = '';
                document.getElementById('cardQuestion').value = '';
                document.getElementById('cardAnswer').value = '';
                document.getElementById('cardCategory').value = kategorie[0] || '';
            }
            
            feather.replace();
            document.getElementById('cardModal').style.display = 'flex';
        };

        window.closeCardModal = function() {
            document.getElementById('cardModal').style.display = 'none';
        };

        window.saveCard = function() {
            const id = document.getElementById('editCardId').value;
            const otazka = document.getElementById('cardQuestion').value;
            const odpoved = document.getElementById('cardAnswer').value;
            const kategorieValue = document.getElementById('cardCategory').value;
            
            if (!otazka || !odpoved) {
                alert('Vypl≈àte ot√°zku a odpovƒõƒè');
                return;
            }
            
            if (id) {
                const karta = karticky.find(k => k.id == id);
                if (karta) {
                    karta.otazka = otazka;
                    karta.odpoved = odpoved;
                    karta.kategorie = kategorieValue;
                }
            } else {
                const nova = {
                    id: Date.now(),
                    otazka: otazka,
                    odpoved: odpoved,
                    kategorie: kategorieValue,
                    vaha: 0,
                    hodnoceni: []
                };
                karticky.push(nova);
            }
            
            ulozData();
            closeCardModal();
        };

        window.deleteCard = function(id) {
            if (confirm('Opravdu chcete smazat tuto kartiƒçku?')) {
                karticky = karticky.filter(k => k.id != id);
                ulozData();
            }
        };

        function renderCardsList() {
            const filter = document.getElementById('categoryFilter')?.value || 'all';
            const container = document.getElementById('cardsList');
            
            let filtered = karticky;
            if (filter !== 'all') {
                filtered = karticky.filter(k => k.kategorie === filter);
            }
            
            if (filtered.length === 0) {
                container.innerHTML = '<div class="text-center py-12 bg-white rounded-2xl"><p class="text-slate-500">≈Ω√°dn√© kartiƒçky</p></div>';
                return;
            }
            
            container.innerHTML = filtered.map(karta => `
                <div class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100 hover:shadow-md transition-all">
                    <div class="flex items-start justify-between mb-3">
                        <span class="category-tag">
                            <i data-feather="folder" class="w-3 h-3"></i>
                            ${karta.kategorie}
                        </span>
                        <div class="flex gap-1">
                            <button onclick='openCardModal(${JSON.stringify(karta).replace(/'/g, "\\'")})' class="w-8 h-8 bg-blue-50 rounded-lg flex items-center justify-center hover:bg-blue-100">
                                <i data-feather="edit-2" class="w-4 h-4 text-blue-500"></i>
                            </button>
                            <button onclick="deleteCard(${karta.id})" class="w-8 h-8 bg-red-50 rounded-lg flex items-center justify-center hover:bg-red-100">
                                <i data-feather="trash-2" class="w-4 h-4 text-red-500"></i>
                            </button>
                        </div>
                    </div>
                    <p class="font-medium text-slate-800 mb-2">‚ùì ${karta.otazka}</p>
                    <p class="text-sm text-slate-600 mb-3">üí° ${karta.odpoved}</p>
                    <div class="flex items-center justify-between text-xs">
                        <span class="text-slate-400">V√°ha: ${karta.vaha}</span>
                        <span class="text-slate-400">Hodnocen√≠: ${karta.hodnoceni.length}x</span>
                    </div>
                </div>
            `).join('');
            
            feather.replace();
        }

        window.filterCards = function() {
            renderCardsList();
        };

        // Spr√°va kategori√≠ s dvojit√Ωm potvrzen√≠m
        window.openCategoryModal = function() {
            renderCategoriesList();
            document.getElementById('categoryModal').style.display = 'flex';
            feather.replace();
        };

        window.closeCategoryModal = function() {
            document.getElementById('categoryModal').style.display = 'none';
            kategorieKeSmazani = null;
        };

        window.addCategory = function() {
            const nazev = document.getElementById('newCategoryName').value.trim();
            if (!nazev) {
                alert('Zadejte n√°zev kategorie');
                return;
            }
            if (kategorie.includes(nazev)) {
                alert('Tato kategorie ji≈æ existuje');
                return;
            }
            kategorie.push(nazev);
            ulozData();
            renderCategoriesList();
            document.getElementById('newCategoryName').value = '';
        };

        // Funkce pro maz√°n√≠ kategorie s potvrzen√≠m
        window.confirmDeleteCategory = function(nazev) {
            const pocetKaret = karticky.filter(k => k.kategorie === nazev).length;
            
            if (pocetKaret === 0) {
                // Kategorie je pr√°zdn√°, m≈Ø≈æeme smazat rovnou
                if (confirm(`Opravdu chcete smazat kategorii "${nazev}"?`)) {
                    kategorie = kategorie.filter(k => k !== nazev);
                    ulozData();
                    renderCategoriesList();
                }
            } else {
                // Kategorie obsahuje karty - zobraz√≠me potvrzovac√≠ modal
                kategorieKeSmazani = nazev;
                document.getElementById('confirmMessage').innerHTML = 
                    `Kategorie <strong>"${nazev}"</strong> obsahuje <strong>${pocetKaret}</strong> kartiƒçek. Budou tak√© nen√°vratnƒõ smaz√°ny.`;
                document.getElementById('confirmModal').style.display = 'flex';
                feather.replace();
            }
        };

        window.closeConfirmModal = function() {
            document.getElementById('confirmModal').style.display = 'none';
            kategorieKeSmazani = null;
        };

        window.executeDeleteCategory = function() {
            if (kategorieKeSmazani) {
                // Smazat v≈°echny kartiƒçky v kategorii
                karticky = karticky.filter(k => k.kategorie !== kategorieKeSmazani);
                // Smazat kategorii
                kategorie = kategorie.filter(k => k !== kategorieKeSmazani);
                
                ulozData();
                closeConfirmModal();
                closeCategoryModal();
                renderCategoriesList();
            }
        };

        function renderCategoriesList() {
            const container = document.getElementById('categoriesList');
            container.innerHTML = kategorie.map(k => {
                const pocetKaret = karticky.filter(karta => karta.kategorie === k).length;
                return `
                    <div class="flex items-center justify-between bg-slate-50 p-4 rounded-xl">
                        <div>
                            <span class="font-medium text-slate-700">${k}</span>
                            <span class="text-xs text-slate-500 ml-2">${pocetKaret} karet</span>
                        </div>
                        <button onclick="confirmDeleteCategory('${k}')" class="w-10 h-10 bg-red-50 rounded-lg flex items-center justify-center hover:bg-red-100">
                            <i data-feather="trash-2" class="w-4 h-4 text-red-500"></i>
                        </button>
                    </div>
                `;
            }).join('');
            
            feather.replace();
        }

        // P≈ôep√≠n√°n√≠ tab≈Ø
        window.switchTab = function(tab) {
            if (tab === 'learn') {
                document.getElementById('learnTab').classList.remove('hidden');
                document.getElementById('manageTab').classList.add('hidden');
                document.getElementById('progressSection').classList.remove('hidden');
                document.getElementById('tabLearn').classList.add('active');
                document.getElementById('tabManage').classList.remove('active');
                aktualizujUI();
            } else {
                document.getElementById('learnTab').classList.add('hidden');
                document.getElementById('manageTab').classList.remove('hidden');
                document.getElementById('progressSection').classList.add('hidden');
                document.getElementById('tabLearn').classList.remove('active');
                document.getElementById('tabManage').classList.add('active');
                renderCardsList();
            }
            feather.replace();
        };

        // Click outside modals
        document.getElementById('cardModal').addEventListener('click', function(e) {
            if (e.target === this) closeCardModal();
        });
        document.getElementById('categoryModal').addEventListener('click', function(e) {
            if (e.target === this) closeCategoryModal();
        });
        document.getElementById('confirmModal').addEventListener('click', function(e) {
            if (e.target === this) closeConfirmModal();
        });

        // Start
        init();
    </script>
</body>
</html>